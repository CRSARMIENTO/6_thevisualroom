<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.5.1. Porous Medium Notes &mdash; The Visual Room</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="The Visual Room" href="../index.html" />
    <link rel="up" title="1.5. OpenFOAM Projects (Password Protected)" href="openfoam_projects.html" />
    <link rel="next" title="1.5.2. Powder Notes" href="powder_notes.html" />
    <link rel="prev" title="1.5. OpenFOAM Projects (Password Protected)" href="openfoam_projects.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>The Visual Room</span></a></h1>
        <h2 class="heading"><span>1.5.1. Porous Medium Notes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="openfoam_projects.html">1.5. OpenFOAM Projects (Password Protected)</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="powder_notes.html">1.5.2. Powder Notes</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="porous-medium-notes">
<h1>1.5.1. Porous Medium Notes<a class="headerlink" href="#porous-medium-notes" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#re-run-massflow-40-laminar-case" id="id5">Re-run massflow = 40 laminar case</a></li>
<li><a class="reference internal" href="#stl-file-for-ct-scan" id="id6">STL File for CT Scan</a></li>
<li><a class="reference internal" href="#stl-file" id="id7">STL File</a></li>
<li><a class="reference internal" href="#tutorial-on-chtmultiregionsimplefoam" id="id8">Tutorial on chtMultiRegionSimpleFoam</a></li>
<li><a class="reference internal" href="#darcy-solver" id="id9">1. Darcy solver</a></li>
<li><a class="reference internal" href="#darcy-solver-with-heat-transfer" id="id10">2. Darcy solver with heat transfer</a></li>
<li><a class="reference internal" href="#customize-boundary-conditions" id="id11">3. Customize boundary conditions</a></li>
<li><a class="reference internal" href="#two-equation-model" id="id12">4. Two-equation model</a></li>
<li><a class="reference internal" href="#run-the-two-temperature-case" id="id13">5. Run the Two Temperature Case</a></li>
<li><a class="reference internal" href="#test-with-new-boundary-condition" id="id14">5. Test with New Boundary Condition</a></li>
<li><a class="reference internal" href="#xxx-make-poroussimplefoamcopy" id="id15">XXX. Make porousSimpleFoamCopy</a></li>
<li><a class="reference internal" href="#change-darcy-bc-so-that-only-nu-is-used" id="id16">Change Darcy BC so that only nu is used:</a></li>
<li><a class="reference internal" href="#test" id="id17">Test</a></li>
<li><a class="reference internal" href="#two-temperatures" id="id18">Two Temperatures</a></li>
<li><a class="reference internal" href="#test-case" id="id19">Test Case</a></li>
<li><a class="reference internal" href="#problem-with-oscillations-include-relaxation-in-temperature" id="id20">Problem with oscillations - include relaxation in temperature</a></li>
<li><a class="reference internal" href="#id1" id="id21">Test Case</a></li>
<li><a class="reference internal" href="#darcy-forchheimer-boundary-condition" id="id22">Darcy-Forchheimer boundary condition</a></li>
<li><a class="reference internal" href="#id2" id="id23">Test</a></li>
<li><a class="reference internal" href="#darcy-brinkmann-forchheimer-boundary-condition" id="id24">Darcy-Brinkmann-Forchheimer boundary condition</a></li>
<li><a class="reference internal" href="#add-walls-at-constant-temperature" id="id25">Add walls at constant temperature</a></li>
<li><a class="reference internal" href="#convert-to-2d" id="id26">Convert to 2D</a></li>
<li><a class="reference internal" href="#now-add-the-constant-heat-flux-boundary-condition" id="id27">Now add the constant heat flux boundary condition</a></li>
<li><a class="reference internal" href="#parabolic-velocity-field" id="id28">Parabolic velocity field</a></li>
<li><a class="reference internal" href="#try-this-on-the-porous-medium-case" id="id29">Try this on the porous medium case</a></li>
<li><a class="reference internal" href="#alter-velocity-profile-by-changing-the-formula-without-introducing-new-variables" id="id30">Alter velocity profile by changing the formula, without introducing new variables</a></li>
<li><a class="reference internal" href="#alter-velocity-profile-by-changing-the-formula-with-introducing-new-variables" id="id31">Alter velocity profile by changing the formula, with introducing new variables</a></li>
<li><a class="reference internal" href="#introduce-brinkmann-term" id="id32">Introduce Brinkmann term</a></li>
<li><a class="reference internal" href="#remove-transient-component-poroussimpletwotemperaturessteadyrelaxfoam" id="id33">Remove transient component - porousSimpleTwoTemperaturesSteadyRelaxFoam</a></li>
<li><a class="reference internal" href="#test-solver" id="id34">Test solver</a></li>
<li><a class="reference internal" href="#correct-temperature-equation" id="id35">Correct Temperature Equation</a></li>
<li><a class="reference internal" href="#add-fixedmeanvalue-pressure-to-outlet-boundary" id="id36">Add fixedMeanValue pressure to outlet boundary.</a></li>
<li><a class="reference internal" href="#id3" id="id37">Alter velocity profile by changing the formula, with introducing new variables</a></li>
<li><a class="reference internal" href="#correct-darcy-forchheimer-pressure-boundary-so-that-coefficients-are-calulated" id="id38">Correct Darcy-Forchheimer pressure boundary so that coefficients are calulated</a></li>
<li><a class="reference internal" href="#correct-darcy-forchheimer-porosity-model-so-that-coefficients-are-calculated" id="id39">Correct Darcy-Forchheimer porosity model so that coefficients are calculated</a></li>
<li><a class="reference internal" href="#use-momentum-equation-of-zhao" id="id40">Use Momentum Equation of Zhao</a></li>
<li><a class="reference internal" href="#inertia-free-velocity-profile-profile-of-zhao" id="id41">Inertia free velocity profile (Profile of Zhao)</a></li>
<li><a class="reference internal" href="#specify-k-and-f-in-porous-medium" id="id42">Specify K and F in porous medium</a></li>
<li><a class="reference internal" href="#specify-k-and-f-in-boundary" id="id43">Specify K and F in boundary</a></li>
<li><a class="reference internal" href="#test-zhao-case" id="id44">Test Zhao case</a></li>
<li><a class="reference internal" href="#use-momentum-equation-of-calmidi-and-add-thermal-dispersion" id="id45">Use Momentum Equation of Calmidi and add thermal dispersion</a></li>
<li><a class="reference internal" href="#profile-of-vafai" id="id46">Profile of Vafai</a></li>
<li><a class="reference internal" href="#test-calmidi-case" id="id47">Test Calmidi case</a></li>
<li><a class="reference internal" href="#introduce-transient" id="id48">Introduce transient</a></li>
<li><a class="reference internal" href="#influence-of-the-grid" id="id49">Influence of the grid</a></li>
<li><a class="reference internal" href="#changed-inlet-pressure-condition-to-fixedfluxpressure" id="id50">Changed inlet pressure condition to fixedFluxPressure</a></li>
<li><a class="reference internal" href="#tried-poroussimplefoam" id="id51">Tried porousSimpleFoam</a></li>
<li><a class="reference internal" href="#now-modify-poroussimplefoam-so-that-diffusion-is-included-in-laplacian" id="id52">Now modify porousSimpleFoam so that diffusion is included in laplacian</a></li>
<li><a class="reference internal" href="#use-momentum-equation-of-vafai" id="id53">Use Momentum Equation of Vafai</a></li>
<li><a class="reference internal" href="#use-momentum-equation-of-vafai-convection-term-over-epsilon-squared" id="id54">Use Momentum Equation of Vafai - convection term over epsilon squared</a></li>
<li><a class="reference internal" href="#vafai-includes-epsilon-next-to-forchheimer-term" id="id55">Vafai includes epsilon next to Forchheimer term</a></li>
<li><a class="reference internal" href="#add-temperature-to-solver-local-equilibirum-assumption" id="id56">11/09/2017: Add temperature to solver (local equilibirum assumption):</a></li>
<li><a class="reference internal" href="#change-viscosity-name" id="id57">28/10/2017: Change viscosity name:</a></li>
<li><a class="reference internal" href="#add-dictionary-entires-dt-and-w" id="id58">31/10/2017: Add dictionary entires dt and w:</a></li>
<li><a class="reference internal" href="#id4" id="id59">Two temperatures</a></li>
<li><a class="reference internal" href="#two-temperatures-plus-dispersion" id="id60">Two temperatures plus dispersion</a></li>
<li><a class="reference internal" href="#two-temperatures-axi-symmetric" id="id61">Two temperatures axi symmetric</a></li>
</ul>
</div>
<div class="section" id="re-run-massflow-40-laminar-case">
<h2><a class="toc-backref" href="#id5">1.5.1.1. Re-run massflow = 40 laminar case</a><a class="headerlink" href="#re-run-massflow-40-laminar-case" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>divSchemes
{
        div((nuEff*dev2(T(grad(U))))) Gauss linear;
}

decomposeParDict

        numberOfSubdomains 8;
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ plus
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ decomposePar
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mpirun -np 8 buoyantBoussinesqSimpleFoam -parallel &gt; log &amp;
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ tail -f log
</pre></div>
</div>
<p>Added switch in controlDict</p>
<div class="highlight-python"><div class="highlight"><pre>OptimisationSwitches
{
        // Force dumping (at next timestep) and clean exit upon signal
        stopAtWriteNowSignal        10;
}
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reconstructPar</span>
</pre></div>
</div>
<p>File called plot.sh:</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/bash

foamLog log &gt;/dev/null

gnuplot -persist &gt; /dev/null 2&gt;&amp;1 &lt;&lt; EOF
                set logscale y
            set format y &quot;10^%+3T&quot;
                set title &quot;Residual vs. Iteration&quot;
                set xlabel &quot;Iteration&quot;
                set ylabel &quot;Residual&quot;
                plot &quot;logs/UxFinalRes_0&quot; title &#39;Ux&#39; with lines,\
                     &quot;logs/UyFinalRes_0&quot; title &#39;Uy&#39; with lines,\
                 &quot;logs/UzFinalRes_0&quot; title &#39;Uz&#39; with lines,\
                 &quot;logs/TFinalRes_0&quot; title &#39;T&#39; with lines,\
                 &quot;logs/p_rghFinalRes_1&quot; title &#39;p rgh&#39; with lines
EOF
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>chmod +x plot.sh
</pre></div>
</div>
<p>How to monitor residuals</p>
<div class="highlight-python"><div class="highlight"><pre>set logscale y
set title &quot;Residuals&quot;
set ylabel &#39;Residual&#39;
set xlabel &#39;Iteration&#39;
plot &quot;&lt; cat log | grep &#39;Solving for Ux&#39; | cut -d&#39; &#39; -f9 | tr -d &#39;,&#39;&quot; title &#39;Ux&#39; with lines,\
&quot;&lt; cat log | grep &#39;Solving for Uy&#39; | cut -d&#39; &#39; -f9 | tr -d &#39;,&#39;&quot; title &#39;Uy&#39; with lines,\
&quot;&lt; cat log | grep &#39;Solving for Uz&#39; | cut -d&#39; &#39; -f9 | tr -d &#39;,&#39;&quot; title &#39;Uz&#39; with lines,\
&quot;&lt; cat log | grep &#39;Solving for omega&#39; | cut -d&#39; &#39; -f9 | tr -d &#39;,&#39;&quot; title &#39;omega&#39; with lines,\
&quot;&lt; cat log | grep &#39;Solving for k&#39; | cut -d&#39; &#39; -f9 | tr -d &#39;,&#39;&quot; title &#39;k&#39; with lines,\
&quot;&lt; cat log | grep &#39;Solving for p&#39; | cut -d&#39; &#39; -f9 | tr -d &#39;,&#39;&quot; title &#39;p&#39; with lines
pause 1
reread
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">functions</span>
<span class="p">{</span>
          <span class="c1">#include &quot;pressureDifferencePatch&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Command:</p>
<div class="highlight-python"><div class="highlight"><pre>gnuplot monitor -
</pre></div>
</div>
<p>How to kill mpirun</p>
<div class="highlight-python"><div class="highlight"><pre>kill -s 10 $MPIRUN_PID
</pre></div>
</div>
<p>Remove files:</p>
<div class="highlight-python"><div class="highlight"><pre>rm -rf 0.* [1-9]* postProcessing processor* *.foam logs
</pre></div>
</div>
<p>How to monitor pressure difference:</p>
<p>copy pressureDifferencePatch to system folder (same version as rest of code)
change &lt;patch1&gt; to inlet and &lt;patch2&gt; to outlet
chmod +x pressureDifferencePatch</p>
<p>Add to controlDict:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">functions</span>
<span class="p">{</span>
    <span class="c1">#include &quot;pressureDifferencePatch&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Command:</p>
<div class="highlight-python"><div class="highlight"><pre>gnuplot monitor2 -
</pre></div>
</div>
</div>
<div class="section" id="stl-file-for-ct-scan">
<h2><a class="toc-backref" href="#id6">1.5.1.2. STL File for CT Scan</a><a class="headerlink" href="#stl-file-for-ct-scan" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ grep &#39;solid&#39;
</pre></div>
</div>
<p>Go to last line in nano</p>
<p>ctrl + w + v</p>
<p>Go to first line in nano</p>
<p>ctrl + w + y</p>
<p>MeshLab</p>
<p>Import &gt; STL File</p>
<p>Unify duplicate vertices</p>
<p>File &gt; Export mesh as &gt; DXF</p>
</div>
<div class="section" id="stl-file">
<h2><a class="toc-backref" href="#id7">1.5.1.3. STL File</a><a class="headerlink" href="#stl-file" title="Permalink to this headline">¶</a></h2>
<p>Installed FreeCAD
Imported STL file
Part &gt; Create Part from mesh</p>
</div>
<div class="section" id="tutorial-on-chtmultiregionsimplefoam">
<h2><a class="toc-backref" href="#id8">1.5.1.4. Tutorial on chtMultiRegionSimpleFoam</a><a class="headerlink" href="#tutorial-on-chtmultiregionsimplefoam" title="Permalink to this headline">¶</a></h2>
<p>Copied the version from OpenFOAM 2.3:</p>
<div class="highlight-python"><div class="highlight"><pre>http://openfoamwiki.net/index.php/Getting_started_with_chtMultiRegionSimpleFoam_-_planeWall2D
</pre></div>
</div>
<p>cd cht_001_2D_plate</p>
<p>$ ./Allrun</p>
<p>Boundaries may be of different types:
-patch (generic type)
-wall (for solid wall condition, useful for turbulence)
-cyclic (for cyclic simulations)
-symmetryPlane (for symmetry plane)
-empty (to specify that the simulation will be 2D or 1D)
-wedge (for axi-symmetric simulations)
-processor (for parallel computation, automatically defined during the decomposition domain process)</p>
<p>Generate the grid mesh:
$ blockMesh
Check the mesh quality:
$ checkMesh
View the mesh :
$ paraFoam</p>
<p>Be careful with the units! In OpenFOAM incompressible solvers, the solved pressure is p = p&#8217;/rho</p>
<p>Plotting velocity vectors FROM CELL CENTRES (after running icoFoam)
- conflict is that Paraview plots the vector at the face center, whereas OpenFOAM caluclates cell centre values</p>
<p>$ paraFoam -touch
$ paraFoam -builtin</p>
<p>Apply
Move to end of time
Properties &gt; Representation &gt; Surface
Properties &gt; Coloring &gt; U</p>
<p>Properties &gt; Representation &gt; Wireframe
Properties &gt; Coloring &gt; Solid Color</p>
<p>Switch to 2D</p>
<p>Filters &gt; Search &gt; Cell Centres &gt; Apply</p>
<p>Filters &gt; Search &gt; Glyph &gt; Apply
Properties &gt; Glyph Type &gt; 2D Glyph
Properties &gt; Coloring &gt; GlyphVector</p>
<p>Where are the solvers in OpenFOAM?</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $FOAM_APP/solvers
$ ls
</pre></div>
</div>
</div>
<div class="section" id="darcy-solver">
<h2><a class="toc-backref" href="#id9">1.5.1.5. 1. Darcy solver</a><a class="headerlink" href="#darcy-solver" title="Permalink to this headline">¶</a></h2>
<p>Objective: develop a program that solves the velocity and pressure in a fully
saturated porous medium using Darcy&#8217;s law.
div(U) = 0 (1)
U = -k/mu grad(p) (2)
How to solve this mathematical problem? The diffusion equation for the pressure field
is obtained by combining equation (1) and (2):</p>
<p>div(k/mu grad(p)) = 0</p>
<p>This equation is closed to the heat diffusion equation. Hence, we are going to program
our own solver on the basis of the existing laplacianFoam. To do so, we copy
laplacianFoam in our workspace.</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR
$ mkdir -p applications/solvers
$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $FOAM_APP/solvers/basic/laplacianFoam darcyFoam
</pre></div>
</div>
<p>Once the laplacianFoam solver has been copied into the user directory, we rename the main file and edit the Make/files</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd darcyFoam
$ mv laplacianFoam.C darcyFoam.C
$ gedit Make/files
</pre></div>
</div>
<p>Change files</p>
<div class="highlight-python"><div class="highlight"><pre>darcyFoam.C

EXE = $(FOAM_USER_APPBIN)/darcyFoam
</pre></div>
</div>
<p>We can now clean the previous compilation with wclean and compile this new program with wmake.</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean
$ wmake
</pre></div>
</div>
<p>Edit the createFields.H file</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit createFields.H
</pre></div>
</div>
<p>Edit createFields.H</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading field T\n&quot; &lt;&lt; endl;

// Declaration of the pressure field p
// * It is an instance of the object volScalarField (scalar field defined at the cells center),
// * The file «p» must be read at the frist time step to satisfy the constructor. The initial values and boundary conditions are defined during the loading of 0/p.


volScalarField p
(
    IOobject
    (
        &quot;p&quot;,
        runTime.timeName(),
        mesh,
        IOobject::MUST_READ,
        IOobject::AUTO_WRITE
    ),
    mesh
);

// Declaration of the velocity vector field U
// * It is an instance of the object volVectorField (vector field defined at the cells center),
// * U is not read from a file (even if 0/U exist)
// * To satisfy the constructor of the object volVectorField, units and initial values are defined with an additional argument. By default, the boundary conditions are zeroGradient,
// * The file « U » will be written at every output times.

volVectorField U
(
    IOobject
    (
        &quot;U&quot;,
        runTime.timeName(),
        mesh,
        IOobject::NO_READ,
        IOobject::AUTO_WRITE
    ),
    mesh,
    dimensionedVector(&quot;U&quot;, dimensionSet(0,1,-1,0,0,0,0),vector::zero)
);


Info&lt;&lt; &quot;Reading transportProperties\n&quot; &lt;&lt; endl;

IOdictionary transportProperties
(
    IOobject
    (
        &quot;transportProperties&quot;,
        runTime.constant(),
        mesh,
        IOobject::MUST_READ_IF_MODIFIED,
        IOobject::NO_WRITE
    )
);

// Declaration of the fluid viscosity mu and the permeability k.
// They will be loaded from « constant/transportProperties »

Info&lt;&lt; &quot;Reading diffusivity k\n&quot; &lt;&lt; endl;

dimensionedScalar k
(
    transportProperties.lookup(&quot;k&quot;)
);

Info&lt;&lt; &quot;Reading fluid viscosity mu\n&quot; &lt;&lt; endl;

dimensionedScalar mu
(
    transportProperties.lookup(&quot;mu&quot;)
);
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ gedit darcyFoam.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>#include &quot;fvCFD.H&quot;
#include &quot;simpleControl.H&quot;

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
    #include &quot;setRootCase.H&quot;

    #include &quot;createTime.H&quot;
    #include &quot;createMesh.H&quot;
    #include &quot;createFields.H&quot;

    simpleControl simple(mesh);

    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    Info&lt;&lt; &quot;\nCalculating temperature distribution\n&quot; &lt;&lt; endl;

    while (simple.loop())
    {
        Info&lt;&lt; &quot;Time = &quot; &lt;&lt; runTime.timeName() &lt;&lt; nl &lt;&lt; endl;

        while (simple.correctNonOrthogonal())
        {

            // The pressure field p is solved implicitly by a diffusion equation
            solve
            (
                fvm::laplacian(k/mu, p)
            );
        }

        // The velocity vector U is deduced from the pressure field using the Darcy&#39;s law.
        U = -k/mu*fvc::grad(p);

        // runtime selectable variables
        runTime.write();

        // This file contained references to temperature gradient, which is not needed
        //#include &quot;write.H&quot;

        Info&lt;&lt; &quot;ExecutionTime = &quot; &lt;&lt; runTime.elapsedCpuTime() &lt;&lt; &quot; s&quot;
            &lt;&lt; &quot;  ClockTime = &quot; &lt;&lt; runTime.elapsedClockTime() &lt;&lt; &quot; s&quot;
            &lt;&lt; nl &lt;&lt; endl;
    }

    Info&lt;&lt; &quot;End\n&quot; &lt;&lt; endl;

    return 0;
}
</pre></div>
</div>
<p>The useless files are removed and the darcyFoam executable is then compiled.</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm write.H
$ wclean
$ wmake
</pre></div>
</div>
<p>To prepare this « case » we are going to use the tutorial laplacianFoam/flange. The setup will be relatively similar since this latter also solves a diffusion equation.</p>
<div class="highlight-python"><div class="highlight"><pre>$ run
$ cp -r $FOAM_TUTORIALS/basic/laplacianFoam/flange .
$ mv flange porous_005_darcyFoam
$ cd porous_005_darcyFoam
$ rm Allrun Allclean flange.ans
</pre></div>
</div>
<p>To save time, we can pick up and modify an existing blockMeshDict</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf $FOAM_TUTORIALS/incompressible/icoFoam/cavity/constant/polyMesh/blockMeshDict constant/polyMesh/blockMeshDict
$ gedit constant/polyMesh/blockMeshDict
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>convertToMeters 1;

// The vertices can be defined using variables Lx, Ly, Lz. It saves time to modify the size of the domain

Lx 10;
Ly 0.1;
Lz 0.1;

vertices
(
    (0 0 0)
    ($Lx 0 0)
    ($Lx $Ly 0)
    (0 $Ly 0)
    (0 0 $Lz)
    ($Lx 0 $Lz)
    ($Lx $Ly $Lz)
    (0 $Ly $Lz)
);

// Mesh definition (homogeneous grid with a single cell in the y and z axis since the simulation is 1D)

blocks
(
    hex (0 1 2 3 4 5 6 7) (60 1 1) simpleGrading (1 1 1)
);

edges
(
);

boundary
(
    inlet
    {
        type patch;
        faces
        (
                        (0 4 7 3)
        );
    }
    outlet
    {
        type patch;
        faces
        (
                        (2 6 5 1)
        );
    }

        // Faces orthogonal to y and z axis are defined as «empty» to specify that the simulation is 1D

    frontAndBack
    {
        type empty;
        faces
        (
                        (1 5 4 0)
                        (3 7 6 2)
            (0 3 2 1)
            (4 5 6 7)
        );
    }
);

mergePatchPairs
(
);
</pre></div>
</div>
<p>The grid is generated using blockMesh</p>
<div class="highlight-python"><div class="highlight"><pre>$ blockMesh
</pre></div>
</div>
<p>The initial and boundary conditions are changed:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mv 0/T 0/p
$ gedit 0/p
</pre></div>
</div>
<p>Change the temperature file to a pressure file</p>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
    version     2.0;
    format      ascii;
    class       volScalarField;
    object      p;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

dimensions      [1 -1 -2 0 0 0 0];

internalField   uniform 0;

boundaryField
{

    // A pressure drop is imposed between the inlet and the outlet of the computational domain
    inlet
    {
        type            fixedValue;
        value           uniform 1e2;
    }

    outlet
    {
        type            fixedValue;
        value           uniform 0;
    }

    frontAndBack
    {
        type            empty;
    }
}
</pre></div>
</div>
<p>Change the transportProperties:</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit constant/transportProperties
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    &quot;constant&quot;;
    object      transportProperties;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

k              k  [ 0  2  0 0 0 0 0 ] 1e-09;
mu             mu [ 1 -1 -1 0 0 0 0 ] 1e-05;
</pre></div>
</div>
<p>Change the control dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit system/controlDict
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// Since darcyFoam is a steady-state solver without relaxation factor, only one time step is necessary.

endTime         1;

deltaT          1;
</pre></div>
</div>
<p>Change the fvSchemes for the laplacian of k, mu and p.</p>
<p>Remove the fluxRequired for temperature.</p>
<div class="highlight-python"><div class="highlight"><pre>laplacianSchemes
{
    default         none;
    laplacian((k|mu),p) Gauss linear corrected;
}


//fluxRequired
//{
//    default         no;
//    T               ;
//}
</pre></div>
</div>
<p>Solve for pressure not temperature</p>
<div class="highlight-python"><div class="highlight"><pre>solvers
{
    p
    {
        solver          PCG;
        preconditioner  DIC;
        tolerance       1e-06;
        relTol          0;
    }
}
</pre></div>
</div>
<p>Run the simulation:</p>
<div class="highlight-python"><div class="highlight"><pre>$ darcyFoam
</pre></div>
</div>
<p>Results will be plotted using the sample utility and the program Gnuplot. As blockMesh, the program sample requires an input dictionary located in /system</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp $FOAM_UTILITIES/postProcessing/sampling/sample/sampleDict system/.
$ gedit system/sampleDict
</pre></div>
</div>
<p>Edit the sampleDict</p>
<div class="highlight-python"><div class="highlight"><pre>sets
(
    lineX1
    {
        type        midPoint;
        axis        distance;

        //- cavity. Slightly perturbed so not to align with face or edge.
        start       (0 0.05 0.005);
        end         (10 0.05 0.005);
    }

);
</pre></div>
</div>
<p>Run the sample dictionary (it won&#8217;t be able to find 0/U):</p>
<div class="highlight-python"><div class="highlight"><pre>$ sample
</pre></div>
</div>
<p>Plot the results</p>
<div class="highlight-python"><div class="highlight"><pre>$ gnuplot
&gt; set xlabel &quot;distance (m)&quot;
&gt; set ylabel &quot;Pressure (kg/m/s)&quot;
&gt; plot &quot;postProcessing/sets/1/lineX1_p.xy&quot; using 1:2 with lines lw 4 title &quot;p&quot;
</pre></div>
</div>
</div>
<div class="section" id="darcy-solver-with-heat-transfer">
<h2><a class="toc-backref" href="#id10">1.5.1.6. 2. Darcy solver with heat transfer</a><a class="headerlink" href="#darcy-solver-with-heat-transfer" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r darcyFoam darcyFoamTemperature
$ cd darcyFoamTemperature
$ mv darcyFoam.C darcyFoamTemperature.C
$ gedit Make/files
</pre></div>
</div>
<p>Changes files file</p>
<div class="highlight-python"><div class="highlight"><pre>darcyFoamTemperature.C

EXE = $(FOAM_USER_APPBIN)/darcyFoamTemperature
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ gedit createFields.H
</pre></div>
</div>
<p>Added phi and temperature</p>
<div class="highlight-python"><div class="highlight"><pre>// Declaration of the velocity flux phi.
// * It is a surface field (U is projected onto the face of each cell of the grid)
// * It is necessary when using the divergence opereator (fvm::div(phi,T) )
// * Can also be declared using #include &quot;createPhi.H&quot;


    surfaceScalarField phi(&quot;phi&quot;, linearInterpolate(U) &amp; mesh.Sf());

    Info&lt;&lt; &quot;Reading field T\n&quot; &lt;&lt; endl;

// Declaration of the temperature field T . (Do not copy everything manually: copy/paste the declaration of volScalarField p and replace p by T)


    volScalarField T
    (
        IOobject
        (
            &quot;T&quot;,
            runTime.timeName(),
            mesh,
            IOobject::MUST_READ,
            IOobject::AUTO_WRITE
        ),
        mesh
    );
</pre></div>
</div>
<p>Declare thermal conductivity, porosity, heat capacities of fluid and solid.</p>
<div class="highlight-python"><div class="highlight"><pre>// Beside the viscosity mu and the permeability k of the porous medium, we also declare the thermal conductivity DT, the porosity eps and the heat capacities rhoCps and rhoCpf. They are loaded from the file « constant/transportProperties »

Info&lt;&lt; &quot;Reading diffusivity DT\n&quot; &lt;&lt; endl;

dimensionedScalar DT
(
    transportProperties.lookup(&quot;DT&quot;)
);

Info&lt;&lt; &quot;Reading fluid viscosity eps\n&quot; &lt;&lt; endl;

dimensionedScalar eps
(
    transportProperties.lookup(&quot;eps&quot;)
);

Info&lt;&lt; &quot;Reading fluid viscosity rhoCps\n&quot; &lt;&lt; endl;

dimensionedScalar rhoCps
(
    transportProperties.lookup(&quot;rhoCps&quot;)
);

Info&lt;&lt; &quot;Reading fluid viscosity rhoCpf\n&quot; &lt;&lt; endl;

dimensionedScalar rhoCpf
(
    transportProperties.lookup(&quot;rhoCpf&quot;)
);
</pre></div>
</div>
<p>Re-make the solver</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean
$ wmake
</pre></div>
</div>
<p>Add the temperature equation:</p>
<div class="highlight-python"><div class="highlight"><pre>// The surface flux phi is updated from the new value of the velocity profile U.
phi = linearInterpolate(U) &amp; mesh.Sf();

// Solve the advection/diffusion equation for the temperature transport
solve
(
        (eps*rhoCpf+(1.0-eps)*rhoCps)*fvm::ddt(T)
        + rhoCpf*fvm::div(phi,T)
        ==
        fvm::laplacian(DT,T)
);
</pre></div>
</div>
<p>Re-make the solver</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean
$ wmake
</pre></div>
</div>
<p>Copy the previous exercise</p>
<div class="highlight-python"><div class="highlight"><pre>$ run
$ cp -r porous_005_darcyFoam porous_006_darcyFoamTemperature
$ cd porous_006_darcyFoamTemperature
$ rm -rf 1 postProcessing *.foam
</pre></div>
</div>
<p>Create temperature boundary conditions:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp 0/p 0/T
$ gedit 0/T
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>dimensions      [0 0 0 1 0 0 0];

internalField   uniform 273;

boundaryField
{
    inlet
    {
        type            fixedValue;
        value           uniform 573;
    }

    outlet
    {
        type            zeroGradient;
    }

    frontAndBack
    {
        type            empty;
    }
}
</pre></div>
</div>
<p>Edit the transport properties</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit constant/transportProperties
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>k              k  [ 0  2  0 0 0 0 0 ] 1e-09;

mu             mu [ 1 -1 -1 0 0 0 0 ] 1e-05;

eps            eps [ 0 0 0 0 0 0 0 ] 0.4;

DT             DT [ 1 1 -3 -1 0 0 0 ] 1e-02;

rhoCps         rhoCps [ 1 -1 -2 -1 0 0 0 ] 2e4;

rhoCpf         rhoCpf [ 1 -1 -2 -1 0 0 0 ] 5e3;
</pre></div>
</div>
<p>Edit the solver properties add temperature:</p>
<div class="highlight-python"><div class="highlight"><pre>solvers
{
    p
    {
        solver          PCG;
        preconditioner  DIC;
        tolerance       1e-06;
        relTol          0;
    }

    T
    {
        solver          PBiCG;
        preconditioner  DILU;
        tolerance       1e-06;
        relTol          0;
    }
}

SIMPLE
{
    nNonOrthogonalCorrectors 2;
}
</pre></div>
</div>
<p>Edit the discretisation fvSchemes</p>
<div class="highlight-python"><div class="highlight"><pre>ddtSchemes
{
    default         Euler;
}

gradSchemes
{
    default         Gauss linear;
    grad(T)         Gauss linear;
}

divSchemes
{
    default         none;
        div(phi,T)          Gauss linear;
}

laplacianSchemes
{
    default         none;
    laplacian((k|mu),p) Gauss linear corrected;
        laplacian(DT,T) Gauss linear corrected;
}

interpolationSchemes
{
    default         linear;
}

snGradSchemes
{
    default         corrected;
}

fluxRequired
{
    default         no;
    T               ;
}
</pre></div>
</div>
<p>Set a probe to record temperature versus time</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit system/controlDict
</pre></div>
</div>
<p>The probes are functions that are executed on-the-fly during the simulation.
They allow to record the temperature evolution vs time at the probe location.
You can specify as many probes as you want.</p>
<div class="highlight-python"><div class="highlight"><pre>// darcyFoamTemperature is a temporal solver

endTime         60000;

deltaT          100;

writeControl    runTime;

writeInterval   1000;


functions
{
    probes
    {
        type                probes;
        functionObjectLibs  (&quot;libsampling.so&quot;);
        enabled             true;
        outputControl       timeStep;
        outputInterval      1;

        fields
        (
                T
        );

        probeLocations
        (
                (2 0.05 0.05) // Probe 1
                (5 0.05 0.05) // Probe 2
                (9 0.05 0.05) // Probe 3
        );
    }
}
</pre></div>
</div>
<p>Plot the temperature, create a new file, plot_probes</p>
<div class="highlight-python"><div class="highlight"><pre>set key at 50000, 400
set ylabel &quot;temperature (K)&quot;
set xlabel &quot;time (s)&quot;

plot &quot;postProcessing/probes/0/T&quot; using 1:2 with lines lw 4 title &quot;Probe x=2m&quot; ,\
&quot;postProcessing/probes/0/T&quot; using 1:3 with lines lw 4 title &quot;Probe x=5m&quot; ,\
&quot;postProcessing/probes/0/T&quot; using 1:4 with lines lw 4 title &quot;Probe x=9m&quot;
</pre></div>
</div>
<p>Run the script:</p>
<div class="highlight-python"><div class="highlight"><pre>$ gnuplot -persist plot_probes
</pre></div>
</div>
<p>Changed scheme to vanLeer for convective term - gives smoother curves</p>
</div>
<div class="section" id="customize-boundary-conditions">
<h2><a class="toc-backref" href="#id11">1.5.1.7. 3. Customize boundary conditions</a><a class="headerlink" href="#customize-boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>Where is the source code for boundary conditions?</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $FOAM_SRC/finiteVolume/fields/fvPatchFields
$ ls
</pre></div>
</div>
<p>How are boundary conditions defined?</p>
<p>To define boundary conditions that depends on time or on other variables, there are several
possibilities:
- Hardcoding in the solver,
- Program customized boundary conditions,
- With an additional package such as swak4Foam</p>
<p>The porous medium was solved for the pressure, so the boundary conditions for the preussure must be specified.</p>
<p>However, it is more convienient to specify the velocity, hence n.grad(p) = -(mu/k) n.U</p>
<p>Create a new condition inspired by fixedFluxPressure</p>
<div class="highlight-python"><div class="highlight"><pre>$ mkdir -p $WM_PROJECT_USER_DIR/boundary/
$ cd $WM_PROJECT_USER_DIR/boundary/
$ cp -r $FOAM_SRC/finiteVolume/fields/fvPatchFields/derived/fixedFluxPressure darcyGradPressure
$ cd darcyGradPressure
</pre></div>
</div>
<p>Replace strings fixedFluxPressure with darcyGradPressure</p>
<div class="highlight-python"><div class="highlight"><pre>$ rename &#39;s/fixedFluxPressure/darcyGradPressure/g&#39; *.*
$ sed -i &#39;s/fixedFluxPressure/darcyGradPressure/g&#39; *.*
</pre></div>
</div>
<p>Create a files file in Make directory</p>
<div class="highlight-python"><div class="highlight"><pre>$ mkdir Make
$ gedit Make/files
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>darcyGradPressureFvPatchScalarField.C

LIB = $(FOAM_USER_LIBBIN)/ldarcyGradPressure
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ gedit Make/options
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>EXE_INC = -I$(LIB_SRC)/finiteVolume/lnInclude

LIB_LIBS = -lfiniteVolume
</pre></div>
</div>
<p>Clean and make the files</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean
$ wmake
</pre></div>
</div>
<p>Declare <cite>UName_</cite> in darcyGradPressureFvPatchScalarField.H</p>
<div class="highlight-python"><div class="highlight"><pre>/*---------------------------------------------------------------------------*\
                 Class darcyGradPressureFvPatchScalarField Declaration
\*---------------------------------------------------------------------------*/

class darcyGradPressureFvPatchScalarField
:
        public fixedGradientFvPatchScalarField      // This boundary condition derives from the class fixedGradient
{
        // Private data

            //- Name of the velocity field to calculate grad(p)
            word UName_;
</pre></div>
</div>
<p>Add UName in darcyGradPressureFvPatchScalarField.C:</p>
<div class="highlight-python"><div class="highlight"><pre>#include &quot;darcyGradPressureFvPatchScalarField.H&quot;
#include &quot;fvPatchFieldMapper.H&quot;
#include &quot;volFields.H&quot;
#include &quot;surfaceFields.H&quot;
#include &quot;addToRunTimeSelectionTable.H&quot;

// * * * * * * * * * * * * * * * * Constructors  * * * * * * * * * * * * * * //

Foam::darcyGradPressureFvPatchScalarField::darcyGradPressureFvPatchScalarField
(
        const fvPatch&amp; p,
        const DimensionedField&lt;scalar, volMesh&gt;&amp; iF
)
:
        fixedGradientFvPatchScalarField(p, iF),
        UName_(&quot;U&quot;)             // ADDED
{}


Foam::darcyGradPressureFvPatchScalarField::darcyGradPressureFvPatchScalarField
(
        const darcyGradPressureFvPatchScalarField&amp; ptf,
        const fvPatch&amp; p,
        const DimensionedField&lt;scalar, volMesh&gt;&amp; iF,
        const fvPatchFieldMapper&amp; mapper
)
:
        fixedGradientFvPatchScalarField(p, iF),
        UName_(ptf.UName_)              // ADDED
{
        // REMOVED:
        //patchType() = ptf.patchType();

        // Map gradient. Set unmapped values and overwrite with mapped ptf
        //gradient() = 0.0;
        //gradient().map(ptf.gradient(), mapper);

        // Evaluate the value field from the gradient if the internal field is valid
        /*
        if (&amp;iF &amp;&amp; iF.size())
        {
            scalarField::operator=
            (
                //patchInternalField() + gradient()/patch().deltaCoeffs()
                // ***HGW Hack to avoid the construction of mesh.deltaCoeffs
                // which fails for AMI patches for some mapping operations
                patchInternalField() + gradient()*(patch().nf() &amp; patch().delta())
            );
        }
        */
}


Foam::darcyGradPressureFvPatchScalarField::darcyGradPressureFvPatchScalarField
(
        const fvPatch&amp; p,
        const DimensionedField&lt;scalar, volMesh&gt;&amp; iF,
        const dictionary&amp; dict
)
:
        fixedGradientFvPatchScalarField(p, iF),
        UName_(dict.lookupOrDefault&lt;word&gt;(&quot;U&quot;,&quot;U&quot;))                     // ADDED
{
        // REMOVED:

        /*
        if (dict.found(&quot;value&quot;) &amp;&amp; dict.found(&quot;gradient&quot;))
        {
            fvPatchField&lt;scalar&gt;::operator=
            (
                scalarField(&quot;value&quot;, dict, p.size())
            );
            gradient() = scalarField(&quot;gradient&quot;, dict, p.size());
        }
        else
        {
        */
            fvPatchField&lt;scalar&gt;::operator=(patchInternalField());
            gradient() = 0.0;
        //}
}


Foam::darcyGradPressureFvPatchScalarField::darcyGradPressureFvPatchScalarField
(
        const darcyGradPressureFvPatchScalarField&amp; wbppsf
)
:
        fixedGradientFvPatchScalarField(wbppsf),
        UName_(wbppsf.UName_)           // ADDED
{}


Foam::darcyGradPressureFvPatchScalarField::darcyGradPressureFvPatchScalarField
(
        const darcyGradPressureFvPatchScalarField&amp; wbppsf,
        const DimensionedField&lt;scalar, volMesh&gt;&amp; iF
)
:
        fixedGradientFvPatchScalarField(wbppsf, iF),
        UName_(wbppsf.UName_)           // ADDED
{}
</pre></div>
</div>
<p>Change the evaluation of the gradient:</p>
<div class="highlight-python"><div class="highlight"><pre>// * * * * * * * * * * * * * * * Member Functions  * * * * * * * * * * * * * //

void Foam::darcyGradPressureFvPatchScalarField::updateCoeffs
(
        const scalarField&amp; snGradp
)
{
        if (updated())
        {
            return;
        }

        // We recover the value of U at the boundary:

        const fvPatchField&lt;vector&gt;&amp; U =
                patch().lookupPatchField&lt;volVectorField, vector&gt;(UName_);

        // Extract the dictionary from the database:
        const dictionary&amp; transportProperties = db().lookupObject&lt;IOdictionary&gt; (&quot;transportProperties&quot;);

        // Extract viscosity and permeability:
        dimensionedScalar mu(transportProperties.lookup(&quot;mu&quot;));
        dimensionedScalar k(transportProperties.lookup(&quot;k&quot;));

        // The pressure gradient is evaluated at the boundary with the formula:
        // n.grad(p) = -(mu/k)n.U
        // mu.value() allows the access of the value of the object mu declared as a dimensionedScalar
        // patch().nf() returns the normal vector to the patch
        gradient() = -mu.value()/k.value()*(U &amp; patch().nf());

        // curTimeIndex_ = this-&gt;db().time().timeIndex();

        // gradient() = snGradp;
        fixedGradientFvPatchScalarField::updateCoeffs();
}


void Foam::darcyGradPressureFvPatchScalarField::updateCoeffs()
{
        if (updated())
        {
            return;
        }

        // REMOVED:
        /*
        if (curTimeIndex_ != this-&gt;db().time().timeIndex())
        {
            FatalErrorIn(&quot;darcyGradPressureFvPatchScalarField::updateCoeffs()&quot;)
                &lt;&lt; &quot;updateCoeffs(const scalarField&amp; snGradp) MUST be called before&quot;
                   &quot; updateCoeffs() or evaluate() to set the boundary gradient.&quot;
                &lt;&lt; exit(FatalError);
        }
        */
}
</pre></div>
</div>
<p>The library ldarcyGradPressure.so is now compiled and available for all the solvers</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="two-equation-model">
<h2><a class="toc-backref" href="#id12">1.5.1.8. 4. Two-equation model</a><a class="headerlink" href="#two-equation-model" title="Permalink to this headline">¶</a></h2>
<p>This solver will be based on darcyFoamTemperature</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ mkdir darcyFoamTemperatureTwo
$ cp -r darcyFoamTemperature darcyFoamTemperatureTwo
$ cd darcyFoamTemperatureTwo
$ mv darcyFoamTemperature.C darcyFoamTemperatureTwo.C
</pre></div>
</div>
<p>Edit the path for the executable:</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit Make/files
</pre></div>
</div>
<p>Change the files file:</p>
<div class="highlight-python"><div class="highlight"><pre>darcyFoamTemperatureTwo.C

EXE = $(FOAM_USER_APPBIN)/darcyFoamTemperatureTwo
</pre></div>
</div>
<p>Create the fields U, Ts and Tf:</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit createFields.H
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading field p\n&quot; &lt;&lt; endl;

// Declaration of the pressure field p
// * It is an instance of the object volScalarField (scalar field defined at the cells center),
// * The file «p» must be read at the frist time step to satisfy the constructor. The initial values and boundary conditions are defined during the loading of 0/p.


        volScalarField p
        (
            IOobject
            (
                &quot;p&quot;,
                runTime.timeName(),
                mesh,
                IOobject::MUST_READ,
                IOobject::AUTO_WRITE
            ),
            mesh
        );

// Declaration of the velocity vector field U
// * It is an instance of the object volVectorField (vector field defined at the cells center),
// * U is not read from a file (even if 0/U exist)
// * To satisfy the constructor of the object volVectorField, units and initial values are defined with an additional argument. By default, the boundary conditions are zeroGradient,
// * The file « U » will be written at every output times.

        Info&lt;&lt; &quot;Reading field U\n&quot; &lt;&lt; endl;

// The field U is now initialised from 0/U, which allows us to define the boundary condition for U

        volVectorField U
        (
            IOobject
            (
                &quot;U&quot;,
                runTime.timeName(),
                mesh,
                IOobject::MUST_READ,
                IOobject::AUTO_WRITE
            ),
            mesh,
                ///dimensionedVector(&quot;U&quot;, dimensionSet(0,1,-1,0,0,0,0),vector::zero)
        );

// phi is created by calling the createPhi.H

#include &quot;createPhi.H&quot;



// Declaration of the velocity flux phi.
// * It is a surface field (U is projected onto the face of each cell of the grid)
// * It is necessary when using the divergence opereator (fvm::div(phi,T) )
// * Can also be declared using #include &quot;createPhi.H&quot;


//  surfaceScalarField phi(&quot;phi&quot;, linearInterpolate(U) &amp; mesh.Sf()); // REMOVED

        // Declaration of the temperature field Ts

        Info&lt;&lt; &quot;Reading field Ts\n&quot; &lt;&lt; endl;

        volScalarField Ts
        (
            IOobject
            (
                &quot;Ts&quot;,
                runTime.timeName(),
                mesh,
                IOobject::MUST_READ,
                IOobject::AUTO_WRITE
            ),
            mesh
        );

// Declaration of the temperature field Tf

        Info&lt;&lt; &quot;Reading field Tf\n&quot; &lt;&lt; endl;

        volScalarField Tf
        (
            IOobject
            (
                &quot;Tf&quot;,
                runTime.timeName(),
                mesh,
                IOobject::MUST_READ,
                IOobject::AUTO_WRITE
            ),
            mesh
        );

        Info&lt;&lt; &quot;Reading transportProperties\n&quot; &lt;&lt; endl;

        IOdictionary transportProperties
        (
            IOobject
            (
                &quot;transportProperties&quot;,
                runTime.constant(),
                mesh,
                IOobject::MUST_READ_IF_MODIFIED,
                IOobject::NO_WRITE
            )
        );

// Beside the viscosity mu and the permeability k of the porous medium, we also declare the thermal conductivity DT, the porosity eps and the heat capacities rhoCps and rhoCpf. They are loaded from the file « constant/transportProperties »

        Info&lt;&lt; &quot;Reading permeability k\n&quot; &lt;&lt; endl;

        dimensionedScalar k
        (
            transportProperties.lookup(&quot;k&quot;)
        );

        Info&lt;&lt; &quot;Reading permeability mu\n&quot; &lt;&lt; endl;

        dimensionedScalar mu
        (
            transportProperties.lookup(&quot;mu&quot;)
        );

        Info&lt;&lt; &quot;Reading diffusivity DTf\n&quot; &lt;&lt; endl;

        dimensionedScalar DTf
        (
            transportProperties.lookup(&quot;DTf&quot;)
        );

        Info&lt;&lt; &quot;Reading diffusivity DTs\n&quot; &lt;&lt; endl;

        dimensionedScalar DTs
        (
            transportProperties.lookup(&quot;DTs&quot;)
        );

        Info&lt;&lt; &quot;Reading fluid viscosity eps\n&quot; &lt;&lt; endl;

        dimensionedScalar eps
        (
            transportProperties.lookup(&quot;eps&quot;)
        );

        Info&lt;&lt; &quot;Reading fluid viscosity rhoCps\n&quot; &lt;&lt; endl;

        dimensionedScalar rhoCps
        (
            transportProperties.lookup(&quot;rhoCps&quot;)
        );

        Info&lt;&lt; &quot;Reading fluid viscosity rhoCpf\n&quot; &lt;&lt; endl;

        dimensionedScalar rhoCpf
        (
            transportProperties.lookup(&quot;rhoCpf&quot;)
        );

        Info&lt;&lt; &quot;Reading heat exchange coefficient h\n&quot; &lt;&lt; endl;

        dimensionedScalar h
        (
            transportProperties.lookup(&quot;h&quot;)
        );

// Declaration of the fluid viscosity mu and the permeability k.
// They will be loaded from « constant/transportProperties »
/*
        Info&lt;&lt; &quot;Reading diffusivity k\n&quot; &lt;&lt; endl;

        dimensionedScalar k
        (
            transportProperties.lookup(&quot;k&quot;)
        );

        Info&lt;&lt; &quot;Reading fluid viscosity mu\n&quot; &lt;&lt; endl;

        dimensionedScalar mu
        (
            transportProperties.lookup(&quot;mu&quot;)
        );
*/
</pre></div>
</div>
<p>Add the two-equations to darcyFoamTemperatureTwo.C</p>
<p>Correct boundary conditions</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit darcyFoamTemperatureTwo.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>#include &quot;fvCFD.H&quot;
#include &quot;simpleControl.H&quot;

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

int main(int argc, char *argv[])
{
        #include &quot;setRootCase.H&quot;

        #include &quot;createTime.H&quot;
        #include &quot;createMesh.H&quot;
        #include &quot;createFields.H&quot;

        simpleControl simple(mesh);

        // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

        Info&lt;&lt; &quot;\nCalculating temperature distribution\n&quot; &lt;&lt; endl;

        while (simple.loop())
        {
            Info&lt;&lt; &quot;Time = &quot; &lt;&lt; runTime.timeName() &lt;&lt; nl &lt;&lt; endl;

            while (simple.correctNonOrthogonal())
            {

                        // The pressure field p is solved implicitly by a diffusion equation
                        // The matrix for the pressure pEqn is decalred as a fvScalarMatrix and contructed from the discretisation with the finite volume method of the laplacian operator.
                        // This type of dicretisation is more flexible than solve(fvm::laplacian(...))
                        fvScalarMatrix pEqn
                (
                    fvm::laplacian(k/mu, p)
                );

                        // The matrix is inversed with pEqn.solve()
                        pEqn.solve();

                        if(simple.finalNonOrthogonalIter())
                        {
                                phi = -pEqn.flux();
                        }
            }


                // The velocity vector U is deduced from the pressure field using the Darcy&#39;s law.
                U = -k/mu*fvc::grad(p);
                // The boundary conditions may have been altered and do not correspond to what is specified in 0/U
                // This function means the BCs are those specified in 0/U
                U.correctBoundaryConditions();

                // The surface flux phi is updated from the new value of the velocity profile U.
                //phi = linearInterpolate(U) &amp; mesh.Sf();

                // Solve the temperature in the fluid

                // The laplacian discretization scheme is specified in system/fvSchemes in front of the keyword « laplacian(DT,T) ». A part of the exchange term is treated implicitly, the other part explicitly.
                fvScalarMatrix TfEqn
                (
                        eps*rhoCpf*fvm::ddt(Tf) + rhoCpf*fvm::div(phi,Tf)
                        ==
                        fvm::laplacian(eps*DTf,Tf,&quot;laplacian(DT,T)&quot;) - fvm::Sp(h,Tf) + h*Ts
                );
                TfEqn.solve();

                // Solve the temperature in the solid
                fvScalarMatrix TsEqn
                (
                        (1.0-eps)*rhoCps*fvm::ddt(Ts)
                        ==
                        fvm::laplacian((1.0-eps)*DTs,Ts,&quot;laplacian(DT,T)&quot;) - fvm::Sp(h,Ts) + h*Tf
                );
                TsEqn.solve();



                // runtime selectable variables
                runTime.write();

                // This file contained references to temperature gradient, which is not needed
            //#include &quot;write.H&quot;

            Info&lt;&lt; &quot;ExecutionTime = &quot; &lt;&lt; runTime.elapsedCpuTime() &lt;&lt; &quot; s&quot;
                &lt;&lt; &quot;  ClockTime = &quot; &lt;&lt; runTime.elapsedClockTime() &lt;&lt; &quot; s&quot;
                &lt;&lt; nl &lt;&lt; endl;
        }

        Info&lt;&lt; &quot;End\n&quot; &lt;&lt; endl;

        return 0;
}
</pre></div>
</div>
</div>
<div class="section" id="run-the-two-temperature-case">
<h2><a class="toc-backref" href="#id13">1.5.1.9. 5. Run the Two Temperature Case</a><a class="headerlink" href="#run-the-two-temperature-case" title="Permalink to this headline">¶</a></h2>
<p>Copy the previous case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ run
$ cp -r porous_007_darcyFoamTemperatureVanLeer porous_008_darcyFoamTemperatureTwo
$ cd porous_008_darcyFoamTemperatureTwo
</pre></div>
</div>
<p>Remove folders:</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf 0.* [1-9]* postProcessing
</pre></div>
</div>
<p>Create new initial conditions:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mv 0/T 0/Tf
$ cp 0/Tf 0/Ts
$ cp 0/p 0/U
</pre></div>
</div>
<p>Edit the 0/U file:</p>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
        version     2.0;
        format      ascii;
        class       volVectorField;
        object      U;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

dimensions      [0 1 -1 0 0 0 0];

internalField   uniform (0 0 0);

boundaryField
{
        inlet
        {
            type            fixedValue;
                value                   uniform (1.4e-4 0 0);
        }

        outlet
        {
            type            zeroGradient;
        }

        frontAndBack
        {
            type            empty;
        }
}

// ************************************************************************* //
</pre></div>
</div>
<p>Edit the 0/p file - test with 10Pa inlet pressure:</p>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
        version     2.0;
        format      ascii;
        class       volScalarField;
        object      p;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

dimensions      [1 -1 -2 0 0 0 0];

internalField   uniform 0;

boundaryField
{
        inlet
        {
            type            fixedValue;
                //type                  darcyGradPressure;
                value                   uniform 10;
        }

        outlet
        {
            type            fixedValue;
            value           uniform 0;
        }

        frontAndBack
        {
            type            empty;
        }
}

// ************************************************************************* //
</pre></div>
</div>
<p>Edit the 0/Ts file:</p>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
        version     2.0;
        format      ascii;
        class       volScalarField;
        object      Ts;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

dimensions      [0 0 0 1 0 0 0];

internalField   uniform 573;

boundaryField
{
        inlet
        {
            type        zeroGradient;
            //value         uniform 573;
        }

        outlet
        {
            type        zeroGradient;
        }

        frontAndBack
        {
            type        empty;
        }
}

// ************************************************************************* //
</pre></div>
</div>
<p>Edit the 0/Tf file:</p>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
        version     2.0;
        format      ascii;
        class       volScalarField;
        object      Tf;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

dimensions      [0 0 0 1 0 0 0];

internalField   uniform 573;

boundaryField
{
        inlet
        {
            type        fixedValue;
            value           uniform 273;
        }

        outlet
        {
            type        zeroGradient;
        }

        frontAndBack
        {
            type        empty;
        }
}

// ************************************************************************* //
</pre></div>
</div>
<p>Edit the transport properties</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit constant/transportProperties
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
        version     2.0;
        format      ascii;
        class       dictionary;
        location    &quot;constant&quot;;
        object      transportProperties;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

k               k               [ 0  2  0  0 0 0 0 ] 1e-09;

mu              mu              [ 1 -1 -1  0 0 0 0 ] 1e-05;

eps             eps     [ 0  0  0  0 0 0 0 ] 0.4;

DTf             DTf     [ 1  1 -3 -1 0 0 0 ] 1e-04;

DTs             DTs     [ 1  1 -3 -1 0 0 0 ] 1e-02;

rhoCps          rhoCps  [ 1 -1 -2 -1 0 0 0 ] 2e4;

rhoCpf          rhoCpf  [ 1 -1 -2 -1 0 0 0 ] 5e3;

h                               h               [ 1 -1 -3 -1 0 0 0 ] 5e-1;


// ************************************************************************* //
</pre></div>
</div>
<p>Change the solvers in fvSolution:</p>
<div class="highlight-python"><div class="highlight"><pre>solvers
{
        p
        {
            solver          PCG;
            preconditioner  DIC;
            tolerance       1e-06;
            relTol          0;
        }

        Ts
        {
            solver          PCG;
            preconditioner  DIC;
            tolerance       1e-06;
            relTol          0;
        }

        Tf
        {
            solver          PBiCG;
            preconditioner  DILU;
            tolerance       1e-06;
            relTol          0;
        }
}

SIMPLE
{
        nNonOrthogonalCorrectors 2;
}
</pre></div>
</div>
<p>Change the schemes in fvSchemes:</p>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
        version     2.0;
        format      ascii;
        class       dictionary;
        location    &quot;system&quot;;
        object      fvSchemes;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

ddtSchemes
{
        default         Euler;
}

gradSchemes
{
        default         Gauss linear;
        grad(T)         Gauss linear;
}

divSchemes
{
        default         none;
        div(phi,Tf)             Gauss vanLeer;
}

laplacianSchemes
{
        default                 none;
        laplacian((k|mu),p) Gauss linear corrected;
        laplacian(DT,T)         Gauss linear corrected;
}

interpolationSchemes
{
        default         linear;
}

snGradSchemes
{
        default         corrected;
}

fluxRequired
{
        p;
}
</pre></div>
</div>
<p>Change sampleDict to sample fluid and solid temperatures</p>
<div class="highlight-python"><div class="highlight"><pre>fields
(
        Tf
        Ts
);

sets
(
        lineX1
        {
            type        midPoint;
            axis        distance;

            //- cavity. Slightly perturbed so not to align with face or edge.
            start       (0 0.05 0.005);
            end         (10 0.05 0.005);
        }

);
</pre></div>
</div>
<p>Delete the old files and re-run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf 0.* [1-9]* postProcessing
$ darcyFoamTemperatureTwo
$ sample
$ gnuplot -persist plot_probes
</pre></div>
</div>
</div>
<div class="section" id="test-with-new-boundary-condition">
<h2><a class="toc-backref" href="#id14">1.5.1.10. 5. Test with New Boundary Condition</a><a class="headerlink" href="#test-with-new-boundary-condition" title="Permalink to this headline">¶</a></h2>
<p>Copy the previous case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ run
$ cp -r porous_008_darcyFoamTemperatureTwo porous_009_darcyFoamTemperatureTwoBC
$ cd porous_009_darcyFoamTemperatureTwoBC
</pre></div>
</div>
<p>Edit the pressure file to include the new condition:</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit 0/p
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
        version     2.0;
        format      ascii;
        class       volScalarField;
        object      p;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

dimensions      [1 -1 -2 0 0 0 0];

internalField   uniform 0;

boundaryField
{
        inlet
        {
            //type            fixedValue;
                type                    darcyGradPressure;
                value                   uniform 0;
        }

        outlet
        {
            type            fixedValue;
            value           uniform 0;
        }

        frontAndBack
        {
            type            empty;
        }
}

// ************************************************************************* //
</pre></div>
</div>
<p>Add the library to controlDict:</p>
<div class="highlight-python"><div class="highlight"><pre>libs (&quot;ldarcyGradPressure.so&quot;);

functions
{
    probes
    {
        type                probes;
        functionObjectLibs  (&quot;libsampling.so&quot;);
        enabled             true;
        outputControl       timeStep;
        outputInterval      1;

        fields
        (
                T
        );

        probeLocations
        (
                (2 0.05 0.05) // Probe 1
                (5 0.05 0.05) // Probe 2
                (9 0.05 0.05) // Probe 3
        );
    }
}
</pre></div>
</div>
<p>Delete the old files and re-run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf 0.* [1-9]* postProcessing
$ darcyFoamTemperatureTwo
$ sample
$ gnuplot -persist plot_probes
</pre></div>
</div>
</div>
<div class="section" id="xxx-make-poroussimplefoamcopy">
<h2><a class="toc-backref" href="#id15">1.5.1.11. XXX. Make porousSimpleFoamCopy</a><a class="headerlink" href="#xxx-make-poroussimplefoamcopy" title="Permalink to this headline">¶</a></h2>
<p>Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $FOAM_APP/solvers/incompressible/simpleFoam simpleCopyFoam

$ cd simpleCopyFoam
$ nano Make/files
    simpleCopyFoam.C

    EXE = $(FOAM_USER_APPBIN)/simpleCopyFoam
$ mv simpleFoam.C simpleCopyFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Porous Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf SRFSimpleFoam
$ mv porousSimpleFoam porousSimpleCopyFoam
$ cd porousSimpleCopyFoam
$ nano Make/files

    porousSimpleCopyFoam.C

    EXE = $(FOAM_USER_APPBIN)/porousSimpleCopyFoam

$ mv porousSimpleFoam.C porousSimpleCopyFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Setup a 1D Case</p>
<div class="highlight-python"><div class="highlight"><pre>$ run
$ cp -rf porous_005_darcyFoam porous_010_porousSimpleCopyFoam
$ rm -rf 0.* [1-9]* postProcessing
</pre></div>
</div>
<p>Add a zone for porosity</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano constant/polyMesh/blockMeshDict

    blocks
    (
        hex (0 1 2 3 4 5 6 7)
        porosity (60 1 1) simpleGrading (1 1 1)
    );
</pre></div>
</div>
<p>Change solver</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano system/controlDict
    application porousSimpleCopyFoam
$ nano 0/p
    dimensions      [0 2 -2 0 0 0 0];

    internalField   uniform 0;

    boundaryField
    {
        inlet
        {
            type            zeroGradient;
        }

        outlet
        {
            type            fixedValue;
            value           uniform 0;
        }

        frontAndBack
        {
            type            empty;
        }

$ cp 0/p 0/U
$ nano 0/U

    FoamFile
    {
        version     2.0;
        format      ascii;
        class       volVectorField;
        object      U;
    }
    // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

    dimensions      [0 1 -1 0 0 0 0];

    internalField   uniform (0 0 0);

    boundaryField
    {
        inlet
        {
            type            fixedValue;
            value           uniform (1.4e-4 0 0);
        }

        outlet
        {
            type            zeroGradient;
        }

        frontAndBack
        {
            type            empty;
        }
    }

$ nano system/controlDict
    libs (&quot;ldarcyGradPressure.so&quot;);
</pre></div>
</div>
<p>Go through each dictionary and match it with angleDuctExplicit (as this used porousSimpleFoam)</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano constant/transportProperties

    transportModel  Newtonian;
    nu              nu [0 2 -1 0 0 0 0] 1.5e-05;

$ nano constant/RASProperties

    RASModel        laminar;

    turbulence      off;

    printCoeffs     off;

$ nano constant/porosityProperties


    porosity1
    {
        type            DarcyForchheimer;
        active          yes;
        cellZone        porosity;

        DarcyForchheimerCoeffs
        {
            d   d [0 -2 0 0 0 0 0] (1e9 0 0);
            f   f [0 -1 0 0 0 0 0] (0 0 0);

            coordinateSystem
            {
                type    cartesian;
                origin  (0 0 0);
                coordinateRotation
                {
                    type    axesRotation;
                    e1      (1 0 0);
                    e2      (0 1 0);
                }
            }
        }
    }

$ nano system/controlDict

    application     porousSimpleCopyFoam;

    startFrom       startTime;

    startTime       0;

    stopAt          endTime;

    endTime         200;

    deltaT          1;

    writeControl    timeStep;

    writeInterval   10;

    purgeWrite      0;

    writeFormat     ascii;

    writePrecision  6;

    writeCompression off;

    timeFormat      general;

    timePrecision   6;

    runTimeModifiable true;

    libs (&quot;ldarcyGradPressure.so&quot;);

$ nano system/fvSchemes

    ddtSchemes
    {
        default         steadyState;
    }

    gradSchemes
    {
        default         Gauss linear;
    }

    divSchemes
    {
        default         none;

        div(phi,U)      bounded Gauss upwind;
        div((nuEff*dev(T(grad(U))))) Gauss linear;
        div(phi,epsilon) bounded Gauss upwind;
        div(phi,k)      bounded Gauss upwind;
    }

    laplacianSchemes
    {
        default         Gauss linear corrected;
    }

    interpolationSchemes
    {
        default         linear;
    }

    snGradSchemes
    {
        default         corrected;
    }

    fluxRequired
    {
        default         no;
        p               ;
    }

$ nano system/fvSchemes

    application     porousSimpleCopyFoam;

    startFrom       startTime;

    startTime       0;

    stopAt          endTime;

    endTime         200;

    deltaT          1;

    writeControl    timeStep;

    writeInterval   10;

    purgeWrite      0;

    writeFormat     ascii;

    writePrecision  6;

    writeCompression off;

    timeFormat      general;

    timePrecision   6;

    runTimeModifiable true;

    libs (&quot;ldarcyGradPressure.so&quot;);
</pre></div>
</div>
<p>Test Darcy BC:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_010_porousSimpleCopyFoam porous_011_porousSimpleCopyDarcyBCFoam
$ cd porous_011_porousSimpleCopyDarcyBCFoam
$ rm -rf 0.* [1-9]* postProcessing *.foam

$ nano 0/p

    inlet
    {
        type            darcyGradPressure;
        value           uniform 0;
    }

$ constant/transportProperties

    // For Darcy BC:
    k               k  [0 2   0 0 0 0 0] 1e-09;
    mu              mu [1 -1 -1 0 0 0 0] 1e-05;

$ porousSimpleCopyFoam
$ sample
$ gnuplot -persist plot_figure
</pre></div>
</div>
<p>Add temperature to solver (local equilibirum assumption):</p>
<p>Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $FOAM_APP/solvers/incompressible/simpleFoam simpleTemperatureFoam

$ cd simpleTemperatureFoam
$ nano Make/files
    simpleTemperatureFoam.C

    EXE = $(FOAM_USER_APPBIN)/simpleTemperatureFoam
$ mv simpleFoam.C simpleTemperatureFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Porous Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf SRFSimpleFoam
$ mv porousSimpleFoam porousSimpleTemperatureFoam
$ cd porousSimpleTemperatureFoam
$ nano Make/files

    porousSimpleTemperatureFoam.C

    EXE = $(FOAM_USER_APPBIN)/porousSimpleTemperatureFoam

$ mv porousSimpleFoam.C porousSimpleTemperatureFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Add temperature field to createFields.H</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano createFields.H

        Info&lt;&lt; &quot;Reading field T\n&quot; &lt;&lt; endl;
        volScalarField T
        (
            IOobject
            (
                &quot;T&quot;,
                runTime.timeName(),
                mesh,
                IOobject::MUST_READ,
                IOobject::AUTO_WRITE
            ),
            mesh
        );

        #include &quot;createPhi.H&quot;
</pre></div>
</div>
<p>Add coefficients</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading transportProperties\n&quot; &lt;&lt; endl;

IOdictionary transportProperties
(
    IOobject
    (
        &quot;transportProperties&quot;,
        runTime.constant(),
        mesh,
        IOobject::MUST_READ,
        IOobject::NO_WRITE
    )
);

Info&lt;&lt; &quot;Reading diffusivity DT\n&quot; &lt;&lt; endl;

dimensionedScalar DT
(
    transportProperties.lookup(&quot;DT&quot;)
);

Info&lt;&lt; &quot;Reading fluid viscosity eps\n&quot; &lt;&lt; endl;

dimensionedScalar eps
(
    transportProperties.lookup(&quot;eps&quot;)
);

Info&lt;&lt; &quot;Reading fluid viscosity rhoCps\n&quot; &lt;&lt; endl;

dimensionedScalar rhoCps
(
    transportProperties.lookup(&quot;rhoCps&quot;)
);

Info&lt;&lt; &quot;Reading fluid viscosity rhoCpf\n&quot; &lt;&lt; endl;

dimensionedScalar rhoCpf
(
    transportProperties.lookup(&quot;rhoCpf&quot;)
);
</pre></div>
</div>
<p>Add TEqn.H to porousSimpleTemperatureFoam.C</p>
<div class="highlight-python"><div class="highlight"><pre>turbulence-&gt;correct();

#include &quot;TEqn.H&quot;
</pre></div>
</div>
<p>Create TEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>cp UEqn.H TEqn.H
</pre></div>
</div>
<p>Add this to TEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>solve
(
        (eps*rhoCpf+(1.0-eps)*rhoCps)*fvm::ddt(T)
        + rhoCpf*fvm::div(phi,T)
        ==
        fvm::laplacian(DT,T)
);
</pre></div>
</div>
<p>Add the case</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_011_porousSimpleCopyDarcyBCFoam porous_012_porousSimpleTemperatureFoam
$ cd porous_012_porousSimpleTemperatureFoam
$ rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<p>Create temperature boundary conditions:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp 0/p 0/T
$ nano 0/T
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FoamFile
{
        version     2.0;
        format      ascii;
        class       volScalarField;
        object      T;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

dimensions      [0 0 0 1 0 0 0];

internalField   uniform 273;

boundaryField
{
    inlet
    {
        type            fixedValue;
        value               uniform 573;
    }

    outlet
    {
        type            zeroGradient;
    }

    frontAndBack
    {
        type            empty;
    }
}
</pre></div>
</div>
<p>Add coefficients for temperature equation for transportProperties</p>
<p>Edit the transport properties</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit constant/transportProperties
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>eps            eps [ 0 0 0 0 0 0 0 ] 0.4;

DT             DT [ 1 1 -3 -1 0 0 0 ] 1e-02;

rhoCps         rhoCps [ 1 -1 -2 -1 0 0 0 ] 2e4;

rhoCpf         rhoCpf [ 1 -1 -2 -1 0 0 0 ] 5e3;
</pre></div>
</div>
<p>Edit the solver properties add temperature:</p>
<div class="highlight-python"><div class="highlight"><pre>solvers
{
    ...

    T
    {
        solver          PBiCG;
        preconditioner  DILU;
        tolerance       1e-06;
        relTol          0;
    }
}
</pre></div>
</div>
<p>Edit the schemes:</p>
<div class="highlight-python"><div class="highlight"><pre>divSchemes
{
        ...
        div(phi,T) bounded Gauss linear;
}

laplacianSchemes
{
        ...
        laplacian(DT,T) Gauss linear corrected;
}

fluxRequired
{
        ...
        T               ;
}
</pre></div>
</div>
<p>Add a probe to controlDict and change application.</p>
<div class="highlight-python"><div class="highlight"><pre>application     porousSimpleTemperatureFoam;

functions
{
        probes
        {
            type            probes;
            functionObjectLibs      (&quot;libsampling.so&quot;);
            enabled         true;
            outputControl   timeStep;
            outputInterval  1;

            fields
            (
                T
            );

            probeLocations
            (
                (2 0.05 0.05) // Probe 1
                (5 0.05 0.05) // Probe 2
                (9 0.05 0.05) // Probe 3
            );
        }
}
</pre></div>
</div>
<p>Run the case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf 0.* [1-9]* postProcessing *.foam
$ porousSimpleTemperatureFoam
</pre></div>
</div>
<p>Transient Solver - Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTemperatureFoam simpleTemperatureTransientFoam
$ cd simpleTemperatureTransientFoam
$ nano Make/files
    simpleTemperatureFoam.C

    EXE = $(FOAM_USER_APPBIN)/simpleTemperatureFoam
$ mv simpleTemperatureFoam.C simpleTemperatureTransientFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Transient Solver - Porous Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTemperatureFoam porousSimpleTemperatureTransientFoam
$ cd porousSimpleTemperatureTransientFoam
$ nano Make/files

    porousSimpleCopyFoam.C

    EXE = $(FOAM_USER_APPBIN)/porousSimpleCopyFoam

$ mv porousSimpleTemperatureFoam.C porousSimpleTemperatureTransientFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Add this to TEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>solve
(
        (eps*rhoCpf+(1.0-eps)*rhoCps)*fvm::ddt(T)
        + rhoCpf*fvm::div(phi,T)
        ==
        fvm::laplacian(DT,T)
);
</pre></div>
</div>
<p>Remake code:</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean
$ wmake
</pre></div>
</div>
<p>Create Case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_012_porousSimpleTemperatureFoam porous_013_porousSimpleTemperatureTransientFoam
$ cd porous_013_porousSimpleTemperatureTransientFoam
$ rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<p>Edit fvSchemes for transient case</p>
<div class="highlight-python"><div class="highlight"><pre>ddtSchemes
{
    default         Euler;
}

divSchemes
{
    ...
    div(phi,T) Gauss linear;
}
</pre></div>
</div>
<p>Edit controlDict for transient case</p>
<div class="highlight-python"><div class="highlight"><pre>application     porousSimpleTemperatureTransientFoam;

endTime         60000;

deltaT          100;

writeControl    runTime;

writeInterval   1000;
</pre></div>
</div>
<p>Try removing the convection term in the solver:</p>
<p>Transient Solver - Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTemperatureTransientFoam simpleTemperatureTransientNoConvectionFoam
$ cd simpleTemperatureTransientNoConvectionFoam
$ nano Make/files
    simpleTemperatureTransientNoConvectionFoam.C

    EXE = $(FOAM_USER_APPBIN)/simpleTemperatureTransientNoConvectionFoam
$ mv simpleTemperatureTransientFoam.C simpleTemperatureTransientNoConvectionFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Transient Solver - Porous Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTemperatureTransientFoam porousSimpleTemperatureTransientNoConvectionFoam
$ cd porousSimpleTemperatureTransientNoConvectionFoam
$ nano Make/files

    porousSimpleTemperatureTransientNoConvectionFoam.C

    EXE = $(FOAM_USER_APPBIN)/porousSimpleTemperatureTransientNoConvectionFoam

$ mv porousSimpleTemperatureTransientFoam.C porousSimpleTemperatureTransientNoConvectionFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Create the case</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_013_porousSimpleTemperatureTransientFoam porous_014_porousSimpleTemperatureTransientNoConvectionFoam
$ cd porous_014_porousSimpleTemperatureTransientNoConvectionFoam
$ rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<p>Try reducing the darcy factor and including density of one.
Density of one = same, reducing Darcy factor = different.</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_013_porousSimpleTemperatureTransientFoam porous_014_porousSimpleTemperatureTransientNoConvectionFoam
$ cd porous_014_porousSimpleTemperatureTransientNoConvectionFoam
$ rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<p>Try removing viscosity and convection</p>
<p>Transient Solver - Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTemperatureTransientNoConvectionFoam simpleTemperatureTransientNoConvectionDiffusionFoam
$ cd simpleTemperatureTransientNoConvectionDiffusionFoam
$ nano Make/files
    simpleTemperatureTransientNoConvectionDiffusionFoam.C

    EXE = $(FOAM_USER_APPBIN)/simpleTemperatureTransientNoConvectionDiffusionFoam
$ mv simpleTemperatureTransientNoConvectionFoam.C simpleTemperatureTransientNoConvectionDiffusionFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Transient Solver - Porous Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTemperatureTransientNoConvectionFoam porousSimpleTemperatureTransientNoConvectionDiffusionFoam
$ cd simpleTemperatureTransientNoConvectionDiffusionFoam
$ nano Make/files

    porousSimpleTemperatureTransientNoConvectionDiffusionFoam.C

    EXE = $(FOAM_USER_APPBIN)/porousSimpleTemperatureTransientNoConvectionDiffusionFoam

$ mv porousSimpleTemperatureTransientNoConvectionFoam.C porousSimpleTemperatureTransientNoConvectionDiffusionFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Create the case</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_014_porousSimpleTemperatureTransientNoConvectionFoam porous_016_porousSimpleTemperatureTransientNoConvectionDiffusionFoam
$ cd porous_016_porousSimpleTemperatureTransientNoConvectionDiffusionFoam
$ rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<p>Create the case</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_015_porousSimpleTemperatureTransientDarcyFoam porous_017_porousSimpleTemperatureTransientDarcyVanLeerFoam
$ cd porous_017_porousSimpleTemperatureTransientDarcyVanLeerFoam
$ rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<p>Change scheme for vanLeer</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano system/fvSchemes

divSchemes
{
        ...
        div(phi,T)              Gauss vanLeer;
}
</pre></div>
</div>
<p>Run the case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ porousSimpleTemperatureTransientFoam
</pre></div>
</div>
</div>
<div class="section" id="change-darcy-bc-so-that-only-nu-is-used">
<h2><a class="toc-backref" href="#id16">1.5.1.12. Change Darcy BC so that only nu is used:</a><a class="headerlink" href="#change-darcy-bc-so-that-only-nu-is-used" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf darcyGradPressure darcyGradPressureIncompressible
$ cd darcyGradPressureIncompressible
$ nano Make/files

darcyGradPressureIncompressibleFvPatchScalarField.C

        LIB = $(FOAM_USER_LIBBIN)/ldarcyGradPressureIncompressible

$ mv darcyGradPressureFvPatchScalarField.C darcyGradPressureIncompressibleFvPatchScalarField.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// We recover the value of U at the boundary:

const fvPatchField&lt;vector&gt;&amp; U =
        patch().lookupPatchField&lt;volVectorField, vector&gt;(UName_);

// Extract the dictionary from the database:
const dictionary&amp; transportProperties = db().lookupObject&lt;IOdictionary&gt; (&quot;transportProperties&quot;);

// Extract viscosity and permeability:
dimensionedScalar nu(transportProperties.lookup(&quot;nu&quot;));
dimensionedScalar d(transportProperties.lookup(&quot;d&quot;));

// The pressure gradient is evaluated at the boundary with the formula:
// n.grad(p) = -(mu/k)n.U
// mu.value() allows the access of the value of the object mu declared as a dimensionedScalar
// patch().nf() returns the normal vector to the patch
gradient() = -nu.value()*d.value()*(U &amp; patch().nf());

// curTimeIndex_ = this-&gt;db().time().timeIndex();

// gradient() = snGradp;
fixedGradientFvPatchScalarField::updateCoeffs();
</pre></div>
</div>
</div>
<div class="section" id="test">
<h2><a class="toc-backref" href="#id17">1.5.1.13. Test</a><a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>cp -rf porous_017_porousSimpleTemperatureTransientDarcyVanLeerFoam/ porous_018_porousSimpleTemperatureTransientDarcyVanLeerIncompressibleFoam/
cd porous_018_porousSimpleTemperatureTransientDarcyVanLeerIncompressibleFoam
rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<p>Change transportProperties:</p>
<div class="highlight-python"><div class="highlight"><pre>nu             nu [0 2 -1 0 0 0 0] 1e-05;

d              d  [0 -2   0 0 0 0 0] 1e9;
</pre></div>
</div>
<p>Change controlDict</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">libs</span> <span class="p">(</span><span class="s2">&quot;ldarcyGradPressureIncompressible.so&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Run the case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ porousSimpleTemperature
</pre></div>
</div>
</div>
<div class="section" id="two-temperatures">
<h2><a class="toc-backref" href="#id18">1.5.1.14. Two Temperatures</a><a class="headerlink" href="#two-temperatures" title="Permalink to this headline">¶</a></h2>
<p>Transient Solver - Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTemperatureTransientFoam simpleTwoTemperaturesTransientFoam
$ cd simpleTwoTemperaturesTransientFoam
$ nano Make/files
    simpleTwoTemperaturesTransientFoam.C

    EXE = $(FOAM_USER_APPBIN)/simpleTwoTemperaturesTransientFoam
$ mv simpleTemperatureTransientFoam.C simpleTwoTemperaturesTransientFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Transient Solver - Porous Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTemperatureTransientFoam porousSimpleTwoTemperaturesTransientFoam
$ cd porousSimpleTwoTemperaturesTransientFoam
$ nano Make/files

    porousSimpleTwoTemperaturesTransientFoam.C

    EXE = $(FOAM_USER_APPBIN)/porousSimpleTwoTemperaturesTransientFoam

$ mv porousSimpleTemperatureTransientFoam.C porousSimpleTwoTemperaturesTransientFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Add the fields and input parameters:</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading field Ts\n&quot; &lt;&lt; endl;
volScalarField Ts
(
    IOobject
    (
        &quot;Ts&quot;,
        runTime.timeName(),
        mesh,
        IOobject::MUST_READ,
        IOobject::AUTO_WRITE
    ),
    mesh
);


Info&lt;&lt; &quot;Reading field Tf\n&quot; &lt;&lt; endl;
volScalarField Tf
(
    IOobject
    (
        &quot;Tf&quot;,
        runTime.timeName(),
        mesh,
        IOobject::MUST_READ,
        IOobject::AUTO_WRITE
    ),
    mesh
);
</pre></div>
</div>
<p>The defintion of the diffusivity:</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading diffusivity DTf\n&quot; &lt;&lt; endl;

dimensionedScalar DTf
(
    transportProperties.lookup(&quot;DTf&quot;)
);

Info&lt;&lt; &quot;Reading diffusivity DTs\n&quot; &lt;&lt; endl;

dimensionedScalar DTs
(
    transportProperties.lookup(&quot;DTs&quot;)
);
</pre></div>
</div>
<p>Add the temperature equations in TEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>fvScalarMatrix TfEqn
(
      eps*rhoCpf*fvm::ddt(Tf)
    + rhoCpf*fvm::div(phi,Tf)
    ==
      fvm::laplacian(eps*DTf,Tf,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(h,Tf)
    + h*Ts
);
TfEqn.solve();

fvScalarMatrix TsEqn
(
      (1.0-eps)*rhoCps*fvm::ddt(Ts)
    ==
      fvm::laplacian((1.0-eps)*DTs,Ts,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(h,Ts)
    + h*Tf
);
TsEqn.solve();
</pre></div>
</div>
</div>
<div class="section" id="test-case">
<h2><a class="toc-backref" href="#id19">1.5.1.15. Test Case</a><a class="headerlink" href="#test-case" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>cp -rf porous_018_porousSimpleTemperatureTransientDarcyVanLeerIncompressibleFoam porous_019_porousSimpleTwoTemperaturesTransientFoam
cd porous_019_porousSimpleTwoTemperaturesTransientFoam
rm -rf 0.* [1-9]* postProcessing *.foam
cp T Tf
mv T Ts
</pre></div>
</div>
<p>Change temperature Tf:</p>
<div class="highlight-python"><div class="highlight"><pre>dimensions      [0 0 0 1 0 0 0];

internalField   uniform 573;

boundaryField
{
        inlet
        {
            type            fixedValue;
            value           uniform 273;
        }

        outlet
        {
            type            zeroGradient;
        }

        frontAndBack
        {
            type            empty;
        }
}
</pre></div>
</div>
<p>Change temperature Ts:</p>
<div class="highlight-python"><div class="highlight"><pre>dimensions      [0 0 0 1 0 0 0];

internalField   uniform 573;

boundaryField
{
        inlet
        {
            type            zeroGradient;
        }

        outlet
        {
            type            zeroGradient;
        }

        frontAndBack
        {
            type            empty;
        }
}
</pre></div>
</div>
<p>Change transport properties:</p>
<div class="highlight-python"><div class="highlight"><pre>transportModel  Newtonian;

nu             nu [0 2 -1 0 0 0 0] 1e-05;

// For Darcy BC:

d              d  [0 -2   0 0 0 0 0] 1e9;

// For temperature equation:

eps            eps [ 0 0 0 0 0 0 0 ] 0.4;

DTf            DTf [ 1 1 -3 -1 0 0 0 ] 1e-04;

DTs            DTs [ 1 1 -3 -1 0 0 0 ] 1e-02;

rhoCps         rhoCps [ 1 -1 -2 -1 0 0 0 ] 2e4;

rhoCpf         rhoCpf [ 1 -1 -2 -1 0 0 0 ] 5e3;

h              h [ 1 -1 -3 -1 0 0 0 ] 5e-1;
</pre></div>
</div>
<p>Change controlDict:</p>
<div class="highlight-python"><div class="highlight"><pre>application     porousSimpleTwoTemperaturesTransientFoam;

functions
{
        probes
        {
            type            probes;
            functionObjectLibs      (&quot;libsampling.so&quot;);
            enabled         true;
            outputControl   timeStep;
            outputInterval  1;

            fields
            (
                Tf
                Ts
            );

            probeLocations
            (
                (2 0.05 0.05) // Probe 1
                (5 0.05 0.05) // Probe 2
                (9 0.05 0.05) // Probe 3
            );
        }
}
</pre></div>
</div>
<p>Edit fvSolution:</p>
<div class="highlight-python"><div class="highlight"><pre>{
...
        Ts
        {
            solver          PCG;
            preconditioner  DIC;
            tolerance       1e-06;
            relTol          0;
        }

        Tf
        {
            solver          PBiCG;
            preconditioner  DILU;
            tolerance       1e-06;
            relTol          0;
        }
}

SIMPLE
{
        nNonOrthogonalCorrectors 2;
}
</pre></div>
</div>
<p>Change fvSchemes:</p>
<div class="highlight-python"><div class="highlight"><pre>divSchemes
{
        ...
        div(phi,Tf) Gauss vanLeer;
    div(phi,Ts) Gauss vanLeer;
}
</pre></div>
</div>
<p>Run the case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ porousSimpleTwoTemperaturesTransientFoam
</pre></div>
</div>
</div>
<div class="section" id="problem-with-oscillations-include-relaxation-in-temperature">
<h2><a class="toc-backref" href="#id20">1.5.1.16. Problem with oscillations - include relaxation in temperature</a><a class="headerlink" href="#problem-with-oscillations-include-relaxation-in-temperature" title="Permalink to this headline">¶</a></h2>
<p>simpleTwoTemperaturesTransientRelaxFoam</p>
<p>Transient Solver - Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTwoTemperaturesTransientFoam simpleTwoTemperaturesTransientRelaxFoam
$ cd simpleTwoTemperaturesTransientRelaxFoam
$ nano Make/files
    simpleTwoTemperaturesTransientRelaxFoam.C

    EXE = $(FOAM_USER_APPBIN)/simpleTwoTemperaturesTransientRelaxFoam
$ mv simpleTwoTemperaturesTransientFoam.C simpleTwoTemperaturesTransientRelaxFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Transient Solver - Porous Simple Foam</p>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTwoTemperaturesTransientFoam porousSimpleTwoTemperaturesTransientRelaxFoam
$ cd porousSimpleTwoTemperaturesTransientRelaxFoam
$ nano Make/files

    porousSimpleTwoTemperaturesTransientRelaxFoam.C

    EXE = $(FOAM_USER_APPBIN)/porousSimpleTwoTemperaturesTransientRelaxFoam

$ mv porousSimpleTwoTemperaturesTransientFoam.C porousSimpleTwoTemperaturesTransientRelaxFoam.C
$ wclean
$ wmake
</pre></div>
</div>
<p>Add the temperature equations in TEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>fvScalarMatrix TfEqn
(
      eps*rhoCpf*fvm::ddt(Tf)
    + rhoCpf*fvm::div(phi,Tf)
    ==
      fvm::laplacian(eps*DTf,Tf,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(h,Tf)
    + h*Ts
);
TfEqn.relax();
TfEqn.solve();

fvScalarMatrix TsEqn
(
      (1.0-eps)*rhoCps*fvm::ddt(Ts)
    ==
      fvm::laplacian((1.0-eps)*DTs,Ts,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(h,Ts)
    + h*Tf
);
TfEqn.relax();
TsEqn.solve();
</pre></div>
</div>
<p>Move #createFields.H in porousSimpleTwoTemperaturesTransientRelaxFoam.C</p>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id21">1.5.1.17. Test Case</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>cp -rf porous_019_porousSimpleTwoTemperaturesTransientFoam  porous_020_porousSimpleTwoTemperaturesTransientRelaxFoam
cd porous_020_porousSimpleTwoTemperaturesTransientRelaxFoam
rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<p>Relaxation solver:</p>
<div class="highlight-python"><div class="highlight"><pre>application     porousSimpleTwoTemperaturesTransientRelaxFoam;
</pre></div>
</div>
<p>Cause of instability is the porosity was 0.15x109 in porosityProperties. This did not match the porosity in the transportProperties. vanLeer scheme can be used.</p>
<p>Is it because the coefficients were different or is it because the coefficients were too small?</p>
<p>Using 1x108 for both works - so it must have been because the coefficients were different. Hence the probelm is with the boundary condition</p>
</div>
<div class="section" id="darcy-forchheimer-boundary-condition">
<h2><a class="toc-backref" href="#id22">1.5.1.18. Darcy-Forchheimer boundary condition</a><a class="headerlink" href="#darcy-forchheimer-boundary-condition" title="Permalink to this headline">¶</a></h2>
<p>Copy darcyGradPressureIncompressible boundary condition</p>
<p>replace darcyGradPressureIncompressible with darcyForchheimer</p>
<p>Change the .C file lines:</p>
<p>dimensionedScalar f(transportProperties.lookup(&#8220;f&#8221;));</p>
<p>gradient() = -(nu.value()*d.value() + 0.5*f.value()*fabs(U &amp; patch().nf()))*(U &amp; patch().nf());</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id23">1.5.1.19. Test</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>copied old folder</p>
<p>deleted files</p>
<p>added forchheimer to porosityProperties (0.1)</p>
<p>changed controlDict so that new BC is applied</p>
<p>changed 0/p so darcyForchheimer is applied</p>
</div>
<div class="section" id="darcy-brinkmann-forchheimer-boundary-condition">
<h2><a class="toc-backref" href="#id24">1.5.1.20. Darcy-Brinkmann-Forchheimer boundary condition</a><a class="headerlink" href="#darcy-brinkmann-forchheimer-boundary-condition" title="Permalink to this headline">¶</a></h2>
<p>Copy darcyForchheimer boundary condition - change to darcyBrinkmannForchheimer</p>
<p>replace darcyForchheimer with darcyBrinkmannForchheimer</p>
<p>Change the .C file lines:</p>
<p>dimensionedScalar eps(transportProperties.lookup(&#8220;eps&#8221;));</p>
<p>gradient() = (turbulence-&gt;divDevReff(U)/eps.value()) - (nu.value()*d.value() + 0.5*f.value()*(U &amp; patch().nf()))*(U &amp; patch().nf());</p>
<p>change Make/files</p>
<p>DIDN&#8217;T WORK - USE DARCY_FORCHHEIMER</p>
</div>
<div class="section" id="add-walls-at-constant-temperature">
<h2><a class="toc-backref" href="#id25">1.5.1.21. Add walls at constant temperature</a><a class="headerlink" href="#add-walls-at-constant-temperature" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>cp -rf porous_021_porousSimpleTwoTemperaturesTransientRelaxFoamForchheimer  porous_022_porousSimpleTwoTemperaturesWalls
cd porous_022_porousSimpleTwoTemperaturesWalls
rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">constant</span><span class="o">/</span><span class="n">polyMesh</span><span class="o">/</span><span class="n">blockMeshDict</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>walls
 {
     type wall;
     faces
     (
         (3 7 6 2)
         (0 1 5 4)
     );
 }

 frontAndBack
 {
     type empty;
     faces
     (
         (0 3 2 1)
         (4 5 6 7)
     );
 }
</pre></div>
</div>
<p>Tf</p>
<div class="highlight-python"><div class="highlight"><pre>walls
 {
     type            fixedValue;
     value           uniform 573;
 }
</pre></div>
</div>
<p>Ts</p>
<div class="highlight-python"><div class="highlight"><pre>walls
 {
     type            fixedValue;
     value           uniform 573;
 }
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ blockMesh
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ porousSimpleTwoTemperaturesTransientRelaxFoam
</pre></div>
</div>
</div>
<div class="section" id="convert-to-2d">
<h2><a class="toc-backref" href="#id26">1.5.1.22. Convert to 2D</a><a class="headerlink" href="#convert-to-2d" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>cp -rf porous_022_porousSimpleTwoTemperaturesWalls porous_023_porousSimpleTwoTemperaturesWalls2D
cd porous_023_porousSimpleTwoTemperaturesWalls2D
rm -rf 0.* [1-9]* postProcessing processor* *.foam logs
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Lx 10;
Ly 1;
Lz 0.1;


// Mesh definition (homogeneous grid with a single cell in the y and z axis since the simulation is$

blocks
(
        hex (0 1 2 3 4 5 6 7)
        porosity (60 10 1) simpleGrading (1 1 1)
);
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ blockMesh
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ porousSimpleTwoTemperaturesTransientRelaxFoam
</pre></div>
</div>
</div>
<div class="section" id="now-add-the-constant-heat-flux-boundary-condition">
<h2><a class="toc-backref" href="#id27">1.5.1.23. Now add the constant heat flux boundary condition</a><a class="headerlink" href="#now-add-the-constant-heat-flux-boundary-condition" title="Permalink to this headline">¶</a></h2>
<ol class="upperalpha simple">
<li>change the solver to deal with single temp</li>
</ol>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTwoTemperaturesTransientRelaxFoam simpleOneTemperatureTransientRelaxFoam
$ cd simpleOneTemperatureTransientRelaxFoam</p>
<p class="last">$ mv simpleTwoTemperaturesTransientRelaxFoam.C simpleOneTemperatureTransientRelaxFoam.C
$ sed -i s/simpleTwoTemperaturesTransientRelaxFoam/simpleOneTemperatureTransientRelaxFoam/g Make/files
$ wclean
$ wmake</p>
</dd>
</dl>
<ol class="arabic simple">
<li>edit createFields.H:</li>
</ol>
<p>Declare only one temp field
Read onoly one diffusivity</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit createFields.H

        #include &quot;createPhi.H&quot;

        Info&lt;&lt; &quot;Reading field T\n&quot; &lt;&lt; endl;
        volScalarField T
        (
            IOobject
            (
                &quot;T&quot;,
                runTime.timeName(),
                mesh,
                IOobject::MUST_READ,
                IOobject::AUTO_WRITE
            ),
            mesh
        );


        Info&lt;&lt; &quot;Reading diffusivity DT\n&quot; &lt;&lt; endl;

        dimensionedScalar DT
        (
            transportProperties.lookup(&quot;DT&quot;)
        );
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Edit the sub-directory</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/simpleOneTemperatureTransientRelaxFoam
$ mv porousSimpleTwoTemperaturesTransientRelaxFoam porousSimpleOneTemperatureTransientRelaxFoam
$ cd porousSimpleOneTemperatureTransientRelaxFoam
$ sed -i s/porousSimpleTwoTemperaturesTransientRelaxFoam/porousSimpleOneTemperatureTransientRelaxFoam/g Make/files
$ mv porousSimpleTwoTemperaturesTransientRelaxFoam.C porousSimpleOneTemperatureTransientRelaxFoam.C
</pre></div>
</div>
<p>Edit the TEqn.H file</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit TEqn.H


        fvScalarMatrix TEqn
        (

                    (eps*rhoCpf+(1.0-eps)*rhoCps)*fvm::ddt(T)
            + rhoCpf*fvm::div(phi,T)
            ==
                fvm::laplacian(DT,T)
        );

        TEqn.relax();
        TEqn.solve();


$ wclean
$ wmake
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>test the new solver</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_023_porousSimpleTwoTemperaturesWalls2D porous_024_porousSimpleOneTemperatureWalls2D
$ cd porous_024_porousSimpleOneTemperatureWalls2D
$ rm -rf 0.* [1-9]* postProcessing *.foam
$ cd 0
$ rm Ts
$ mv Tf T
$ nano T

        object T;

$ nano system/controlDict

        application     porousSimpleOneTemperatureTransientRelaxFoam;

fields
(
    T
);

$ nano 0/T

        internalField   uniform 273;

        inlet
        {
            type            fixedValue;
                value               uniform 573;
        }

$ nano constant/transportProperties

        DT             DT [ 1 1 -3 -1 0 0 0 ] 1e-02;

$ nano system/fvSolution

        T
        {
            solver          PBiCG;
            preconditioner  DILU;
            tolerance       1e-06;
            relTol          0;
        }

$ nano system/fvSchemes

        divSchemes
        {
                div(phi,T) Gauss vanLeer;
        }

        laplacianSchemes
        {

                laplacian((k|mu),p) Gauss linear corrected;

        }

        fluxRequired
        {
                default         no;
                p               ;
            T               ;
        }
</pre></div>
</div>
<p>Run the solver - make sure it is the correct solver!!!!! not the parent solver</p>
<div class="highlight-python"><div class="highlight"><pre>$ porousSimpleOneTemperatureTransientRelaxFoam
</pre></div>
</div>
<p>Edit the gnuplot file:</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano plot_probes

set ylabel &quot;temperature (K)&quot;
set xlabel &quot;time (s)&quot;

plot &quot;postProcessing/probes/0/T&quot; using 1:2 with lines lw 4 linecolor rgb &quot;red&quot; title &quot;T Probe x=2m&quot; ,\
    &quot;postProcessing/probes/0/T&quot; using 1:3 with lines lw 4 linecolor rgb &quot;green&quot; title &quot;T Probe x=5m&quot; ,\
    &quot;postProcessing/probes/0/T&quot; using 1:4 with lines lw 4 linecolor rgb &quot;blue&quot; title &quot;T Probe x=9m&quot;

$ gnuplot
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Change the walls so that upper_wall and lower_wall is created</li>
</ol>
<p>copy the previous case directory and rename</p>
<p>Edit the blockMeshDict to change walls to wall_one and wall_two</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit constant/polyMesh/blockMeshDict

        wall_upper
        {
            type wall;
            faces
            (
                (3 7 6 2)
            );
        }

        wall_lower
        {
            type wall;
            faces
            (
                (0 1 5 4)
            );
        }

$ blockMesh
</pre></div>
</div>
<p>Change the boundary conditions</p>
<div class="highlight-python"><div class="highlight"><pre>$ gedit 0/p

        wall_upper
        {
                type            darcyForchheimer;
                value           uniform 0;
        }

        wall_lower
        {
                type            darcyForchheimer;
                value           uniform 0;
        }

$ gedit 0/T

        wall_upper
        {
                type            fixedValue;
                value           uniform 273;
        }

        wall_lower
        {
                type            fixedValue;
                value           uniform 273;
        }

$ gedit 0/U

        wall_upper
        {
                type            fixedValue;
                value           uniform (0 0 0);
        }

        wall_lower
        {
                type            fixedValue;
                value           uniform (0 0 0);
        }
</pre></div>
</div>
<p>Run the solver - make sure it is the correct solver!!!!! not the parent solver</p>
<div class="highlight-python"><div class="highlight"><pre>$ porousSimpleOneTemperatureTransientRelaxFoam
</pre></div>
</div>
<ol class="upperalpha simple" start="2">
<li>add a constant heat flux boundary condition</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_025_porousSimpleOneTemperatureWalls2DUpperLower porous_026_porousSimpleOneTemperatureWalls2DUpperLowerHeatFlux
$ cd porous_026_porousSimpleOneTemperatureWalls2DUpperLowerHeatFlux
$ rm -rf 0.* [1-9]* postProcessing *.foam *.png
</pre></div>
</div>
<p>make the boundary condition:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/boundary/wallHeatFluxIncompressible
$ wclean libso
$ wmake libso
</pre></div>
</div>
<p>add the library:</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano system/controlDict

        libs
        (
                &quot;ldarcyForchheimer.so&quot;
                &quot;libwallHeatFluxIncompressible.so&quot;
        );
</pre></div>
</div>
<p>Run the solver - make sure it is the correct solver!!!!! not the parent solver</p>
<blockquote>
<div>$ porousSimpleOneTemperatureTransientRelaxFoam</div></blockquote>
<ol class="upperalpha simple" start="3">
<li>add the constant heat flux condition to the lower wall</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ nano 0/T

        wall_lower
        {
                type            wallHeatFluxIncompressible;
                value           uniform 273;
        }
</pre></div>
</div>
</div>
<div class="section" id="parabolic-velocity-field">
<h2><a class="toc-backref" href="#id28">1.5.1.24. Parabolic velocity field</a><a class="headerlink" href="#parabolic-velocity-field" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ mkdir -p $WM_PROJECT_USER_DIR/src/finiteVolume/fields/fvPatchFields/derived/parabolicVelocity
$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/fields/fvPatchFields/derived/parabolicVelocity
</pre></div>
</div>
<p>Download .C and .H files from: <a class="reference external" href="https://github.com/Unofficial-Extend-Project-Mirror/openfoam-extend-Core-OpenFOAM-1.5-dev/tree/master/src/finiteVolume/fields/fvPatchFields/derived/parabolicVelocity">https://github.com/Unofficial-Extend-Project-Mirror/openfoam-extend-Core-OpenFOAM-1.5-dev/tree/master/src/finiteVolume/fields/fvPatchFields/derived/parabolicVelocity</a></p>
<blockquote>
<div><ol class="arabic simple">
<li>Go to the file you want to download.</li>
<li>Click it to view the contents within the GitHub UI.</li>
<li>In the top right, right click the Raw button.</li>
<li>Save as...</li>
</ol>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre>$ mkdir Make
$ cd Make
$ gedit files

        parabolicVelocityFvPatchVectorField.C
        LIB = $(FOAM_USER_LIBBIN)/libmyBCs

$ gedit options

        EXE_INC = \
        -I$(LIB_SRC)/finiteVolume/lnInclude
        EXE_LIBS =
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ run
$ cp -r $FOAM_TUTORIALS/incompressible/simpleFoam/pitzDaily porous_029_pitzDailyParabolicInletDynamicLibrary
$ cd porous_029_pitzDailyParabolicInletDynamicLibrary
$ blockMesh
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ nano 0/U

        inlet
        {
                type            parabolicVelocity;
                n               (1 0 0);
                y               (0 1 0);
                maxValue        1;
                value           uniform (0 0 0); // Dummy for paraFoam
        }
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ system/controlDict

        libs (&quot;libmyBCs.so&quot;);
</pre></div>
</div>
</div>
<div class="section" id="try-this-on-the-porous-medium-case">
<h2><a class="toc-backref" href="#id29">1.5.1.25. Try this on the porous medium case</a><a class="headerlink" href="#try-this-on-the-porous-medium-case" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ nano 0/U

        inlet
        {
                type            parabolicVelocity;
                n               (1 0 0);
                y               (0 1 0);
                maxValue        1;
                value           uniform (0 0 0); // Dummy for paraFoam
        }
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ system/controlDict

        libs (&quot;libmyBCs.so&quot;);
</pre></div>
</div>
</div>
<div class="section" id="alter-velocity-profile-by-changing-the-formula-without-introducing-new-variables">
<h2><a class="toc-backref" href="#id30">1.5.1.26. Alter velocity profile by changing the formula, without introducing new variables</a><a class="headerlink" href="#alter-velocity-profile-by-changing-the-formula-without-introducing-new-variables" title="Permalink to this headline">¶</a></h2>
<p>Create a new folder constantCoefficientsProfile</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ mv parabolicVelocityFvPatchVectorField.C constantCoefficientsFvPatchVectorField.C
$ mv parabolicVelocityFvPatchVectorField.H constantCoefficientsFvPatchVectorField.H
$ sed -i s/parabolicVelocity/constantCoefficients/g constantCoefficientsFvPatchVectorField.C
$ sed -i s/parabolicVelocity/constantCoefficients/g constantCoefficientsFvPatchVectorField.H
$ sed -i s/parabolicVelocity/constantCoefficients/g Make/files
</pre></div>
</div>
<p>Test the solver, changing:</p>
<div class="highlight-python"><div class="highlight"><pre>$ system/controlDict

        libs
        (
                &quot;ldarcyForchheimer.so&quot;
                &quot;libconstantCoefficients.so&quot;
        );

$ 0/U

        inlet
        {
            type            constantCoefficients;
            n               (1 0 0);
            y               (0 1 0);
            maxValue        1;
            value           uniform (0 0 0); // Dummy for paraFoam
        }
</pre></div>
</div>
</div>
<div class="section" id="alter-velocity-profile-by-changing-the-formula-with-introducing-new-variables">
<h2><a class="toc-backref" href="#id31">1.5.1.27. Alter velocity profile by changing the formula, with introducing new variables</a><a class="headerlink" href="#alter-velocity-profile-by-changing-the-formula-with-introducing-new-variables" title="Permalink to this headline">¶</a></h2>
<p>Create a new folder constantCoefficientsProfile</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ mv constantCoefficientsFvPatchVectorField.C hyperbolicVelocityFvPatchVectorField.C
$ mv constantCoefficientsFvPatchVectorField.H hyperbolicVelocityFvPatchVectorField.H
$ sed -i s/constantCoefficients/hyperbolicVelocity/g hyperbolicVelocityFvPatchVectorField.C
$ sed -i s/constantCoefficients/hyperbolicVelocity/g hyperbolicVelocityFvPatchVectorField.H
$ sed -i s/constantCoefficients/hyperbolicVelocity/g Make/files
</pre></div>
</div>
<p>Test the solver, changing:</p>
<div class="highlight-python"><div class="highlight"><pre>$ system/controlDict

        libs
        (
                &quot;ldarcyForchheimer.so&quot;
                &quot;libhyperbolicVelocity.so&quot;
        );

$ 0/U

        inlet
        {
            type            hyperbolicVelocity;
            n               (1 0 0);
            y               (0 1 0);
            maxValue        1;
            value           uniform (0 0 0); // Dummy for paraFoam
        }
</pre></div>
</div>
</div>
<div class="section" id="introduce-brinkmann-term">
<h2><a class="toc-backref" href="#id32">1.5.1.28. Introduce Brinkmann term</a><a class="headerlink" href="#introduce-brinkmann-term" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_034_porousSimpleTwoTemperaturesWalls2DPorousHyperbolicInletDarcyForchheimerCalculated porous_035_porousSimpleTwoTemperaturesWalls2DHyperbolicBrinkmann
$ cd porous_035_porousSimpleTwoTemperaturesWalls2DHyperbolicBrinkmann
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume
$ mkdir cfdTools
$ cd cfdTools
$ mkdir general
$ cd general
$ mkdir porosityModel
$ mkdir $WM_PROJECT_USER_DIR/src/finiteVolume/cfdTools/general/porosityModel/
$ mkdir /cfdTools/general/porosityModel/
$ cp -r $FOAM_SRC/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer DarcyBrinkmannForchheimer
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd DarcyBrinkmannForchheimer
$ mv DarcyForchheimer.C DarcyBrinkmannForchheimer.C
$ mv DarcyForchheimer.H DarcyBrinkmannForchheimer.H
$ mv DarcyForchheimerTemplates.C DarcyBrinkmannForchheimerTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ sed -i s/DarcyForchheimer/DarcyBrinkmannForchheimer/g DarcyBrinkmannForchheimer.C
$ sed -i s/DarcyForchheimer/DarcyBrinkmannForchheimer/g DarcyBrinkmannForchheimer.H
$ sed -i s/DarcyForchheimer/DarcyBrinkmannForchheimer/g DarcyBrinkmannForchheimerTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/finiteVolume
$ mkdir Make
$ cd Make
$ gedit files

general = cfdTools/general
porosity = $(general)/porosityModel
$(porosity)/DarcyBrinkmannForchheimer/DarcyBrinkmannForchheimer.C
LIB = $(FOAM_USER_LIBBIN)/libmyfiniteVolume

$ gedit options

        EXE_INC = \
-I$(LIB_SRC)/triSurface/lnInclude \
-I$(LIB_SRC)/meshTools/lnInclude \
-I$(LIB_SRC)/finiteVolume/lnInclude
LIB_LIBS = \
-lOpenFOAM \
-ltriSurface \
-lmeshTools
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ wmake libso
</pre></div>
</div>
<p>Add library to system/controlDict:</p>
<div class="highlight-python"><div class="highlight"><pre>$ system/controlDict

        libs
        (
                &quot;ldarcyForchheimer.so&quot;
                &quot;libhyperbolicVelocity.so&quot;
                &quot;libmyfiniteVolume.so&quot;
        );
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ constant/porosityProperties

    type            DarcyBrinkmannForchheimer;
    active          yes;
    cellZone        porosity;

    DarcyBrinkmannForchheimerCoeffs
    {
        d   d [0 -2 0 0 0 0 0] (1.0e9 0 0);
        f   f [0 -1 0 0 0 0 0] (0.1 0 0);

        coordinateSystem
        {
            type    cartesian;
            origin  (0 0 0);
            coordinateRotation
            {
                type    axesRotation;
                e1      (1 0 0);
                e2      (0 1 0);
            }
        }
    }
</pre></div>
</div>
</div>
<div class="section" id="remove-transient-component-poroussimpletwotemperaturessteadyrelaxfoam">
<h2><a class="toc-backref" href="#id33">1.5.1.29. Remove transient component - porousSimpleTwoTemperaturesSteadyRelaxFoam</a><a class="headerlink" href="#remove-transient-component-poroussimpletwotemperaturessteadyrelaxfoam" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>::</dt>
<dd>$ mv simpleTwoTemperaturesTransientRelaxFoam.C simpleTwoTemperaturesSteadyRelaxFoam.C
$ mv porousSimpleTwoTemperaturesTransientRelaxFoam.C porousSimpleTwoTemperaturesSteadyRelaxFoam.C</dd>
</dl>
<div class="highlight-python"><div class="highlight"><pre>fvScalarMatrix TfEqn
    (
          rhoCpf*fvm::div(phi,Tf)
        ==
          fvm::laplacian(eps*DTf,Tf,&quot;laplacian(DT,T)&quot;)
        - fvm::Sp(h,Tf)
        + h*Ts
    );
    TfEqn.relax();
    TfEqn.solve();

    fvScalarMatrix TsEqn
    (
          fvm::laplacian((1.0-eps)*DTs,Ts,&quot;laplacian(DT,T)&quot;)
        - fvm::Sp(h,Ts)
        + h*Tf
    );
    TsEqn.relax();
    TsEqn.solve();
</pre></div>
</div>
<p>Make/files</p>
<div class="highlight-python"><div class="highlight"><pre>simpleTwoTemperaturesSteadyRelaxFoam.C

EXE = $(FOAM_USER_APPBIN)/simpleTwoTemperaturesSteadyRelaxFoam
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd simpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
<p>Make/files</p>
<div class="highlight-python"><div class="highlight"><pre>porousSimpleTwoTemperaturesSteadyRelaxFoam.C

EXE = $(FOAM_USER_APPBIN)/porousSimpleTwoTemperaturesSteadyRelaxFoam
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd porousSimpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="test-solver">
<h2><a class="toc-backref" href="#id34">1.5.1.30. Test solver</a><a class="headerlink" href="#test-solver" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ system/fvSchemes

ddt {

default none

}
</pre></div>
</div>
<p>Edit system/controlDict:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">simpleTwoTemperaturesSteadyRelaxFoam</span>
</pre></div>
</div>
<p>Edit system/sampleDict:</p>
<div class="highlight-python"><div class="highlight"><pre>sets
(
    lineX1
    {
        type        midPoint;
        axis        distance;

        //- cavity. Slightly perturbed so not to align with face or edge.
        start       (0.000 0.010 0.000);
        end         (0.100 0.010 0.000);
    }

);
</pre></div>
</div>
<p>Run sample utility:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sample
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ gnuplot -persist plot_temperature
$ gnuplot -persist plot_pressure
$ gnuplot -persist plot_temperature
</pre></div>
</div>
<p>Read nu from transportProperties</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading kinematic viscosity nu\n&quot; &lt;&lt; endl;

dimensionedScalar nu
(
    transportProperties.lookup(&quot;nu&quot;)
);
</pre></div>
</div>
<p>recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd simpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd porousSimpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
<p>Replace turbulence with laminar in porousSimpleTwoTemperaturesSteadyRelaxFoam/UEqn.H and simpleTwoTemperaturesSteadyRelaxFoam/UEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>// Construct the Momentum equation
Info&lt;&lt; &quot;Construct the Momentum equation = &quot; &lt;&lt; endl;
tmp&lt;fvVectorMatrix&gt; UEqn
(
    fvm::div(phi, U)
  - fvm::laplacian(nu,U)
  ==
    fvOptions(U)
);
</pre></div>
</div>
<p>recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd simpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd porousSimpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
<p>Divide nu by eps in porousSimpleTwoTemperaturesSteadyRelaxFoam/UEqn.H and simpleTwoTemperaturesSteadyRelaxFoam/UEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>// Construct the Momentum equation
tmp&lt;fvVectorMatrix&gt; UEqn
(
    fvm::div(phi, U)
  - fvm::laplacian(nu/eps,U)
  ==
    fvOptions(U)
);
</pre></div>
</div>
<p>recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd simpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd porousSimpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="correct-temperature-equation">
<h2><a class="toc-backref" href="#id35">1.5.1.31. Correct Temperature Equation</a><a class="headerlink" href="#correct-temperature-equation" title="Permalink to this headline">¶</a></h2>
<p>Read in surface area density and correct notations</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading effective fluid thermal conductivity kfe\n&quot; &lt;&lt; endl;

dimensionedScalar kfe
(
    transportProperties.lookup(&quot;kfe&quot;)
);

Info&lt;&lt; &quot;Reading effective solid thermal conductivity kse\n&quot; &lt;&lt; endl;

dimensionedScalar kse
(
    transportProperties.lookup(&quot;kse&quot;)
);

Info&lt;&lt; &quot;Reading fluid density times heat capacity rhoCpf\n&quot; &lt;&lt; endl;

dimensionedScalar rhoCpf
(
    transportProperties.lookup(&quot;rhoCpf&quot;)
);

Info&lt;&lt; &quot;Reading interfacial heat transfer coefficient hsf\n&quot; &lt;&lt; endl;

dimensionedScalar hsf
(
    transportProperties.lookup(&quot;hsf&quot;)
);

Info&lt;&lt; &quot;Reading surface area density asf\n&quot; &lt;&lt; endl;

dimensionedScalar asf
(
    transportProperties.lookup(&quot;asf&quot;)
);
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// Tf treated as implicit in TfEqn, Ts treated as explicit
fvScalarMatrix TfEqn
(
      rhof*cpf*fvm::div(phi,Tf)
    ==
      fvm::laplacian(kfe,Tf,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(hsf*asf,Tf)
    + hsf*asf*Ts
);
TfEqn.relax();
TfEqn.solve();

// Ts treated an implicit in TsEqn, Tf treated as explicit
fvScalarMatrix TsEqn
(
      fvm::laplacian(kse,Ts,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(hsf*asf,Ts)
    + hsf*asf*Tf
);
TsEqn.relax();
TsEqn.solve();
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// For temperature equation:

eps            eps [ 0 0 0 0 0 0 0 ] 0.4;

kfe            kfe [ 1 1 -3 -1 0 0 0 ] 1e-04;

kse            kse [ 1 1 -3 -1 0 0 0 ] 1e-04;

rhof           rhof [ 1 -3 0 0 0 0 0 ] 1.184;

cpf            cpf [ 0 2 -2 -1 0 0 0 ] 1007.0;

hsf            hsf [ 1 0 -3 -1 0 0 0 ] 5e-1;

asf                    asf [ 0 -1 0 0 0 0 0 ] 1.0;
</pre></div>
</div>
<p>recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd simpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd porousSimpleTwoTemperaturesSteadyRelaxFoam
$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="add-fixedmeanvalue-pressure-to-outlet-boundary">
<h2><a class="toc-backref" href="#id36">1.5.1.32. Add fixedMeanValue pressure to outlet boundary.</a><a class="headerlink" href="#add-fixedmeanvalue-pressure-to-outlet-boundary" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ mkdir -p $WM_PROJECT_USER_DIR/src/finiteVolume/fields/fvPatchFields/derived/fixedMeanValue
$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/fields/fvPatchFields/derived/fixedMeanValue
</pre></div>
</div>
<p>Download .C and .H files from: <a class="reference external" href="https://github.com/Unofficial-Extend-Project-Mirror/openfoam-extend-Core-OpenFOAM-1.5-dev/tree/master/src/finiteVolume/fields/fvPatchFields/derived/fixedMeanValue">https://github.com/Unofficial-Extend-Project-Mirror/openfoam-extend-Core-OpenFOAM-1.5-dev/tree/master/src/finiteVolume/fields/fvPatchFields/derived/fixedMeanValue</a></p>
<blockquote>
<div><ol class="arabic simple">
<li>Go to the file you want to download.</li>
<li>Click it to view the contents within the GitHub UI.</li>
<li>In the top right, right click the Raw button.</li>
<li>File&gt; Save Page as...</li>
</ol>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre>$ mkdir Make
$ cd Make
$ gedit files

        fixedMeanValueFvPatchField.C
        LIB = $(FOAM_USER_LIBBIN)/libfixedMeanValue

$ gedit options

        EXE_INC = \
        -I$(LIB_SRC)/finiteVolume/lnInclude
        EXE_LIBS =

$ cd ..

$ wclean libso
$ wmake libso
</pre></div>
</div>
<p>!!!!!!!!!!DIDN&#8217;T WORK!!!!!!!!!!!!!!!!!</p>
<p>Instead use fixedMean:</p>
<div class="highlight-python"><div class="highlight"><pre>outlet
{
    type            fixedMean;
    meanValue       0.0;
    value           uniform 0;
}
</pre></div>
</div>
<p>Still no influence on profile, so the mass balance or the grid must be having an influence.</p>
<p>Adjust profile parameters to match mean velocity profile</p>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id37">1.5.1.33. Alter velocity profile by changing the formula, with introducing new variables</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Create a new folder hyperbolicVelocityCalculated</p>
<dl class="docutils">
<dt>::</dt>
<dd>$ mkdir hyperbolicVelocityCalculated
$ cp -rf hyperbolicVelocity hyperbolicVelocityCalculated</dd>
</dl>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ mv hyperbolicVelocityFvPatchVectorField.C hyperbolicVelocityCalculatedFvPatchVectorField.C
$ mv hyperbolicVelocityFvPatchVectorField.H hyperbolicVelocityCalculatedFvPatchVectorField.H
$ sed -i s/hyperbolicVelocity/hyperbolicVelocityCalculated/g hyperbolicVelocityCalculatedFvPatchVectorField.C
$ sed -i s/hyperbolicVelocity/hyperbolicVelocityCalculated/g hyperbolicVelocityCalculatedFvPatchVectorField.H
$ sed -i s/hyperbolicVelocity/hyperbolicVelocityCalculated/g Make/files
</pre></div>
</div>
<ol class="arabic simple">
<li>Add private member variables to hyperbolicVelocityCalculatedFvPatchVectorField.H:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>//- Porosity
scalar epsilon_;

//- Forchheimer Coefficient
scalar forch_;

//- Plate height
scalar height_;

//- Fluid kinematic viscosity
scalar kinVisc_;

//- Permeability
scalar perm_;
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Add private member functions to hyperbolicVelocityCalculatedFvPatchVectorField.H:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>//- Porosity
scalar&amp; epsilon()
{
    return epsilon_;
}

//- Forchheimer Coefficient
scalar&amp; forch()
{
    return forch_;
}

//- height
scalar&amp; height()
{
    return height_;
}

//- height
scalar&amp; kinVisc()
{
    return kinVisc_;
}

//- Permeability
scalar&amp; perm()
{
    return perm_;
}
</pre></div>
</div>
<p>Recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ wmake libso
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Create default values in hyperbolicVelocityCalculatedFvPatchVectorField.C:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="n">epsilon_</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="n">forch_</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="n">height_</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="n">kinVisc_</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="n">perm_</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>epsilon_(ptf.epsilon_),
forch_(ptf.forch_),
height_(ptf.height_,
kinVisc_(ptf.kinVisc_),
perm_(ptf.perm_)
</pre></div>
</div>
<p>Lookup the values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">epsilon_</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;epsilon&quot;</span><span class="p">)),</span>
<span class="n">forch_</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;forch&quot;</span><span class="p">)),</span>
<span class="n">height_</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">)),</span>
<span class="n">kinVisc_</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;kinVisc&quot;</span><span class="p">)),</span>
<span class="n">perm_</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;perm&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Add this code:</p>
<div class="highlight-python"><div class="highlight"><pre>const double Lambda = ((pow(epsilon_, (3.0/2.0)))*forch_*maxValue_*height_) / kinVisc_ ;
const double Darcy = perm_ / (sqr(height_)*epsilon_);
const double ACoeff = (2.0 / 3.0)*Lambda*(pow(Darcy, (-1.0/2.0)));
const double BCoeff = (pow(Darcy, (-1.0))) + (4.0/3.0)*Lambda*pow(Darcy, (-1.0/2.0));
const double DCoeff = (sqrt(ACoeff + BCoeff))/2.0;
const double Value = sqrt(ACoeff/(ACoeff + BCoeff));
const double CCoeff = -(1.0 / DCoeff)*acosh(1.0/Value) - 1.0;

vectorField::operator=(n_*maxValue_*(1.0 - ((ACoeff+BCoeff)/ACoeff)*sqr(  1.0 / (cosh (DCoeff*  (mag(coord) + CCoeff) ) )   )));

Info &lt;&lt; &quot;Lambda&quot; &lt;&lt; Lambda &lt;&lt; endl;
Info &lt;&lt; &quot;Darcy&quot; &lt;&lt; Darcy &lt;&lt; endl;
Info &lt;&lt; &quot;ACoeff&quot; &lt;&lt; ACoeff &lt;&lt; endl;
Info &lt;&lt; &quot;BCoeff&quot; &lt;&lt; BCoeff &lt;&lt; endl;
Info &lt;&lt; &quot;DCoeff&quot; &lt;&lt; DCoeff &lt;&lt; endl;
Info &lt;&lt; &quot;CCoeff&quot; &lt;&lt; CCoeff &lt;&lt; endl;
</pre></div>
</div>
<p>Recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ wmake libso
</pre></div>
</div>
<p><strong>changed so that Darcy and Forchheimer coefficients are calculated</strong></p>
<p>Test the solver, changing:</p>
<div class="highlight-python"><div class="highlight"><pre>$ system/controlDict

        libs
        (
                &quot;ldarcyForchheimer.so&quot;
                &quot;libhyperbolicVelocityCalculated.so&quot;
        );

$ 0/U

        inlet
        {
    type            hyperbolicVelocityCalculated;
    n               (1 0 0);
    y               (0 1 0);
    maxValue        1.0e-4;
        epsilon                 0.380;
        diameter                0.002;
        height                  0.010;
        kinVisc                 1.0e-5;
    value           uniform (0 0 0); // Dummy for paraFoam
        }
</pre></div>
</div>
<p><strong>changed so that Darcy and Forchheimer coefficients are calculated</strong></p>
<p>Checked coefficients against Python code - coefficients were the same</p>
<p>Now make the DarcyBrinkmannForchheimer into DarcyForcheimerCalculated</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/
$ wclean libso
$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/cfdTools/general/porosityModel

$ cp -rf DarcyBrinkmannForchheimer DarcyForchheimerCalculated
$ cd DarcyForchheimerCalculated

$ mv DarcyBrinkmannForchheimer.C DarcyForchheimerCalculated.C
$ mv DarcyBrinkmannForchheimer.H DarcyForchheimerCalculated.H
$ mv DarcyBrinkmannForchheimerTemplates.C DarcyForchheimerCalculatedTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ sed -i s/DarcyBrinkmannForchheimer/DarcyForchheimerCalculated/g DarcyForchheimerCalculated.C
$ sed -i s/DarcyBrinkmannForchheimer/DarcyForchheimerCalculated/g DarcyForchheimerCalculated.H
$ sed -i s/DarcyBrinkmannForchheimer/DarcyForchheimerCalculated/g DarcyForchheimerCalculatedTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/Make
$ gedit files

general = cfdTools/general
porosity = $(general)/porosityModel
$(porosity)/DarcyForchheimerCalculated/DarcyForchheimerCalculated.C
LIB = $(FOAM_USER_LIBBIN)/libmyfiniteVolume

$ gedit options

        EXE_INC = \
-I$(LIB_SRC)/triSurface/lnInclude \
-I$(LIB_SRC)/meshTools/lnInclude \
-I$(LIB_SRC)/finiteVolume/lnInclude
LIB_LIBS = \
-lOpenFOAM \
-ltriSurface \
-lmeshTools
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd ..
$ wclean libso
$ wmake libso
</pre></div>
</div>
<p>Add library to system/controlDict:</p>
<div class="highlight-python"><div class="highlight"><pre>$ system/controlDict

        libs
        (
                &quot;ldarcyForchheimer.so&quot;
                &quot;libhyperbolicVelocity.so&quot;
                &quot;libmyfiniteVolume.so&quot;
        );
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ constant/porosityProperties

type            DarcyForchheimerCalculated;
active          yes;
cellZone        porosity;

DarcyForchheimerCalculatedCoeffs
{
    d   d [0 -2 0 0 0 0 0] (1.0e9 0 0);
    f   f [0 -1 0 0 0 0 0] (0.1 0 0);

    coordinateSystem
    {
        type    cartesian;
        origin  (0 0 0);
        coordinateRotation
        {
            type    axesRotation;
            e1      (1 0 0);
            e2      (0 1 0);
        }
    }
}
</pre></div>
</div>
<p>Installed SWAK4FOAM</p>
<p>tested using cavity case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano 0/U

        movingWall
        {
            type groovyBC;
            valueExpression &quot;vector(sin(w*time()), 0, 0)&quot;;
            variables &quot;w=pi;&quot;;
            value $internalField;
        }

$ nano system/controlDict

        endTime         2.0;
        deltaT          0.001;

        libs (&quot;libgroovyBC.so&quot;);

$ rm -rf 0.* [1-9]* postProcessing *.foam

$ icoFoam &gt; log
</pre></div>
</div>
<p>Now apply Ts = Tf using Swak4Foam:</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf 0.* [1-9]* postProcessing *.foam

$ nano 0/Ts

        wall_upper
        {
                type groovyBC;
                valueExpression &quot;Tf&quot;;
                variables &quot;Tf@wall_upper=Tf;&quot;;
                value $internalField;
        }

$ nano system/controlDict

        libs (&quot;libgroovyBC.so&quot;);


$ porousSimpleTwoTemperaturesSteadyRelaxFoam &gt; log &amp;
</pre></div>
</div>
<p>There is a difference of around 20K between the surface temperature Ts and Tf.</p>
<p>Change the inlet so that there is constant gradient for Ts:</p>
<div class="highlight-python"><div class="highlight"><pre>$ nano 0/Ts

inlet
{
        type    zeroGradient;
}
</pre></div>
</div>
<p>It could be that the temperature has not reached steady state, so the temperature applied is from the previous timestep previous time-step or iteration are utilised</p>
<p>&#8220;When evaluating the expression in run-time, the state of the fields on the remote patches from the previous time-step or iteration are utilised&#8221; - false, the values are not changing with time!!!</p>
<p>Influence of mesh is also possible</p>
</div>
<div class="section" id="correct-darcy-forchheimer-pressure-boundary-so-that-coefficients-are-calulated">
<h2><a class="toc-backref" href="#id38">1.5.1.34. Correct Darcy-Forchheimer pressure boundary so that coefficients are calulated</a><a class="headerlink" href="#correct-darcy-forchheimer-pressure-boundary-so-that-coefficients-are-calulated" title="Permalink to this headline">¶</a></h2>
<p>Easier</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf darcyForchheimer darcyForchheimerCalculated
$ cd darcyForcheimerCalculated
$ nano Make/files

    darcyForchheimerCalculatedFvPatchScalarField.C

        LIB = $(FOAM_USER_LIBBIN)/ldarcyForchheimerCalculated

$ mv darcyForchheimerFvPatchScalarField.C darcyForchheimerCalculatedFvPatchScalarField.C
$ mv darcyForchheimerFvPatchScalarField.H darcyForchheimerCalculatedFvPatchScalarField.H
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ sed -i s/darcyForchheimer/darcyForchheimerCalculated/g darcyForchheimerCalculatedFvPatchScalarField.C
$ sed -i s/darcyForchheimer/darcyForchheimerCalculated/g darcyForchheimerCalculatedFvPatchScalarField.H
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// Extract viscosity, diameter and epsilon:
dimensionedScalar nu(transportProperties.lookup(&quot;nu&quot;));
dimensionedScalar diameter(transportProperties.lookup(&quot;diameter&quot;));
dimensionedScalar eps(transportProperties.lookup(&quot;eps&quot;));


dimensionedScalar darcy =
dimensionedScalar
(
        &quot;darcy&quot;, /// A name field
        dimensionSet( 0, 2, 0, 0, 0, 0, 0 ),
        1.0 /// Value to initialize
);


dimensionedScalar forchheimer =
dimensionedScalar
(
        &quot;forchheimer&quot;, /// A name field
        dimensionSet( 0, 0, 0, 0, 0, 0, 0 ),
        1.0 /// Value to initialize
);

darcy = ( (pow(eps, 3.0))*(sqr(diameter)) ) / (150.0*sqr(1.0 - eps));

forchheimer = 1.75 / ((sqrt(150.0))* pow(eps, (3.0/2.0)));

Info &lt;&lt; &quot;Darcy Coefficient&quot; &lt;&lt; darcy.value() &lt;&lt; endl;
Info &lt;&lt; &quot;Forchheimer Coefficient&quot; &lt;&lt; forchheimer.value() &lt;&lt; endl;

gradient() = -(nu.value()/darcy.value() + ( forchheimer.value()/sqrt(darcy.value()) )*(U &amp; patch().nf()))*(U &amp; patch().nf());
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ wmake libso
</pre></div>
</div>
<p>The function .value() returns a dimensionless number</p>
<p>To have a number with dimensions use the dimensioned scalar variable</p>
</div>
<div class="section" id="correct-darcy-forchheimer-porosity-model-so-that-coefficients-are-calculated">
<h2><a class="toc-backref" href="#id39">1.5.1.35. Correct Darcy-Forchheimer porosity model so that coefficients are calculated</a><a class="headerlink" href="#correct-darcy-forchheimer-porosity-model-so-that-coefficients-are-calculated" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Read in epsilon and diameter</li>
</ol>
<p>The apply function creates the source term:</p>
<div class="highlight-python"><div class="highlight"><pre>template&lt;class RhoFieldType&gt;
void Foam::porosityModels::DarcyForchheimer::apply
(
    scalarField&amp; Udiag,
    vectorField&amp; Usource,
    const scalarField&amp; V,
    const RhoFieldType&amp; rho,
    const scalarField&amp; mu,
    const vectorField&amp; U
) const
{
    forAll(cellZoneIDs_, zoneI)
    {
        const tensorField&amp; dZones = D_[zoneI];
        const tensorField&amp; fZones = F_[zoneI];

        const labelList&amp; cells = mesh_.cellZones()[cellZoneIDs_[zoneI]];

        forAll(cells, i)
        {
            const label cellI = cells[i];
            const label j = this-&gt;fieldIndex(i);
            const tensor Cd =
                mu[cellI]*dZones[j] + (rho[cellI]*mag(U[cellI]))*fZones[j];

            const scalar isoCd = tr(Cd);

            Udiag[cellI] += V[cellI]*isoCd;
            Usource[cellI] -= V[cellI]*((Cd - I*isoCd) &amp; U[cellI]);
        }
    }
}
</pre></div>
</div>
</div>
<div class="section" id="use-momentum-equation-of-zhao">
<h2><a class="toc-backref" href="#id40">1.5.1.36. Use Momentum Equation of Zhao</a><a class="headerlink" href="#use-momentum-equation-of-zhao" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTwoTemperaturesSteadyRelaxFoam simpleTwoTemperaturesZhaoFoam
$ cd simpleTwoTemperaturesZhaoFoam

$ mv simpleTwoTemperaturesSteadyRelaxFoam.C simpleTwoTemperaturesZhaoFoam.C
$ sed -i s/simpleTwoTemperaturesSteadyRelaxFoam/simpleTwoTemperaturesZhaoFoam/g Make/files

$ nano UEqn.H

        tmp&lt;fvVectorMatrix&gt; UEqn
        (
            (1.0/eps)*fvm::div(phi, U)
            - fvm::laplacian(nu/eps, U)
            ==
            fvOptions(U)
        );

$ wclean
$ wmake
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Edit the sub-directory</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTwoTemperaturesSteadyRelaxFoam porousSimpleTwoTemperaturesZhaoFoam
$ cd porousSimpleOneTemperatureTransientRelaxFoam
$ sed -i s/porousSimpleTwoTemperaturesSteadyRelaxFoam/porousSimpleTwoTemperaturesZhaoFoam/g Make/files
$ mv porousSimpleTwoTemperaturesSteadyRelaxFoam.C porousSimpleTwoTemperaturesZhaoFoam.C

$ nano UEqn.H

        tmp&lt;fvVectorMatrix&gt; UEqn
        (
            (1.0/eps)*fvm::div(phi, U)
            - fvm::laplacian(nu/eps, U)
            ==
            fvOptions(U)
        );

$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="inertia-free-velocity-profile-profile-of-zhao">
<h2><a class="toc-backref" href="#id41">1.5.1.37. Inertia free velocity profile (Profile of Zhao)</a><a class="headerlink" href="#inertia-free-velocity-profile-profile-of-zhao" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/fields/fvPatchFields/derived
$ cp -rf hyperbolicVelocityCalculated hyperbolicVelocityZhao
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd hyperbolicVelocityZhao
$ wclean libso
$ mv hyperbolicVelocityCalculatedFvPatchVectorField.C hyperbolicVelocityZhaoFvPatchVectorField.C
$ mv hyperbolicVelocityCalculatedFvPatchVectorField.H hyperbolicVelocityZhaoFvPatchVectorField.H
$ sed -i s/hyperbolicVelocityCalculated/hyperbolicVelocityZhao/g hyperbolicVelocityZhaoFvPatchVectorField.C
$ sed -i s/hyperbolicVelocityCalculated/hyperbolicVelocityZhao/g hyperbolicVelocityZhaoFvPatchVectorField.H
$ sed -i s/hyperbolicVelocityCalculated/hyperbolicVelocityZhao/g Make/files
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ nano hyperbolicVelocityZhaoFvPatchVectorField.H

//- Plate height
scalar h_;

//- Permeability
scalar k_;

//- height
scalar&amp; h()
{
    return h_;
}

//- height
scalar&amp; k()
{
    return k_;
}
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ nano hyperbolicVelocityZhaoFvPatchVectorField.C

        hyperbolicVelocityZhaoFvPatchVectorField::hyperbolicVelocityZhaoFvPatchVectorField
        (
                const fvPatch&amp; p,
                const DimensionedField&lt;vector, volMesh&gt;&amp; iF
        )
        :
                fixedValueFvPatchVectorField(p, iF),
                maxValue_(0),
                n_(1, 0, 0),
                y_(0, 1, 0),
                h_(1),
                k_(1)
        {}


        hyperbolicVelocityZhaoFvPatchVectorField::hyperbolicVelocityZhaoFvPatchVectorField
        (
                const hyperbolicVelocityZhaoFvPatchVectorField&amp; ptf,
                const fvPatch&amp; p,
                const DimensionedField&lt;vector, volMesh&gt;&amp; iF,
                const fvPatchFieldMapper&amp; mapper
        )
        :
                fixedValueFvPatchVectorField(ptf, p, iF, mapper),
                maxValue_(ptf.maxValue_),
                n_(ptf.n_),
                y_(ptf.y_),
                h_(ptf.h_),
                k_(ptf.k_)
        {}


        hyperbolicVelocityZhaoFvPatchVectorField::hyperbolicVelocityZhaoFvPatchVectorField
        (
                const fvPatch&amp; p,
                const DimensionedField&lt;vector, volMesh&gt;&amp; iF,
                const dictionary&amp; dict
        )
        :
                fixedValueFvPatchVectorField(p, iF),
                maxValue_(readScalar(dict.lookup(&quot;maxValue&quot;))),
                n_(dict.lookup(&quot;n&quot;)),
                y_(dict.lookup(&quot;y&quot;)),
                h_(readScalar(dict.lookup(&quot;h&quot;))),
                k_(readScalar(dict.lookup(&quot;k&quot;)))
        {
                if (mag(n_) &lt; SMALL || mag(y_) &lt; SMALL)
                {
                        FatalErrorIn(&quot;hyperbolicVelocityZhaoFvPatchVectorField(dict)&quot;)
                            &lt;&lt; &quot;n or y given with zero size not correct&quot;
                            &lt;&lt; abort(FatalError);
                }

                n_ /= mag(n_);
                y_ /= mag(y_);

                evaluate();
        }


        hyperbolicVelocityZhaoFvPatchVectorField::hyperbolicVelocityZhaoFvPatchVectorField
        (
                const hyperbolicVelocityZhaoFvPatchVectorField&amp; fcvpvf,
                const DimensionedField&lt;vector, volMesh&gt;&amp; iF
        )
        :
                fixedValueFvPatchVectorField(fcvpvf, iF),
                maxValue_(fcvpvf.maxValue_),
                n_(fcvpvf.n_),
                y_(fcvpvf.y_),
                h_(fcvpvf.h_),
                k_(fcvpvf.k_)
        {}


        // * * * * * * * * * * * * * * * Member Functions  * * * * * * * * * * * * * //

        void hyperbolicVelocityZhaoFvPatchVectorField::updateCoeffs()
        {
                if (updated())
                {
                        return;
                }

                // Get range and orientation
                boundBox bb(patch().patch().localPoints(), true);

                vector ctr = 0.5*(bb.max() + bb.min());

                const vectorField&amp; c = patch().Cf();

                // Calculate local 1-D coordinate for the parabolic profile
                scalarField coord = 2*((c - ctr) &amp; y_)/((bb.max() - bb.min()) &amp; y_);

                const double Darcy = sqrt(k_) / h_;
                const double Coefficient =

                vectorField::operator=(n_*maxValue_*(1.0 - ( cosh((Darcy**(-0.5))*mag(coord)) )/cosh((Darcy**(-0.5)) ) ) );


        }


        // Write
        void hyperbolicVelocityZhaoFvPatchVectorField::write(Ostream&amp; os) const
        {
                fvPatchVectorField::write(os);
                os.writeKeyword(&quot;maxValue&quot;)
                        &lt;&lt; maxValue_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;n&quot;)
                        &lt;&lt; n_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;y&quot;)
                        &lt;&lt; y_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;height&quot;)
                        &lt;&lt; h_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;permeability&quot;)
                        &lt;&lt; k_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                writeEntry(&quot;value&quot;, os);
        }
</pre></div>
</div>
<p>Recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ wmake libso
</pre></div>
</div>
</div>
<div class="section" id="specify-k-and-f-in-porous-medium">
<h2><a class="toc-backref" href="#id42">1.5.1.38. Specify K and F in porous medium</a><a class="headerlink" href="#specify-k-and-f-in-porous-medium" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/cfdTools/general/porosityModel
$ cp -rf DarcyForchheimerCalculated DarcyForchheimerCoefficients
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd DarcyForchheimerCoefficients
$ mv DarcyForchheimerCalculated.C DarcyForchheimerCoefficients.C
$ mv DarcyForchheimerCalculated.H DarcyForchheimerCoefficients.H
$ mv DarcyForchheimerCalculatedTemplates.C DarcyForchheimerCoefficientsTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ sed -i s/DarcyForchheimerCalculated/DarcyForchheimerCoefficients/g DarcyForchheimerCoefficients.C
$ sed -i s/DarcyForchheimerCalculated/DarcyForchheimerCoefficients/g DarcyForchheimerCoefficients.H
$ sed -i s/DarcyForchheimerCalculated/DarcyForchheimerCoefficients/g DarcyForchheimerCoefficientsTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume
$ cd Make
$ gedit files

general = cfdTools/general
porosity = $(general)/porosityModel
$(porosity)/DarcyForchheimerCoefficients/DarcyForchheimerCoefficients.C
LIB = $(FOAM_USER_LIBBIN)/libmyfiniteVolume
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd ..
$ wclean libso
$ wmake libso
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimerCoefficients


$ kate DarcyForchheimerCoefficients.H

//- Permeability
dimensionedScalar k_;

//- Forchheimer
dimensionedScalar f_;



$ kate DarcyForchheimerCoefficients.C

        if (coordSys_.R().uniform())
        {
            forAll (cellZoneIDs_, zoneI)
            {
                D_[zoneI].setSize(1);
                F_[zoneI].setSize(1);

                D_[zoneI][0] = tensor::zero;
                D_[zoneI][0].xx() = 1.0 / k_.value();
                D_[zoneI][0].yy() = 1.0 / k_.value();
                D_[zoneI][0].zz() = 1.0 / k_.value();

                D_[zoneI][0] = coordSys_.R().transformTensor(D_[zoneI][0]);

                F_[zoneI][0] = tensor::zero;
                F_[zoneI][0].xx() = f_.value()/sqrt(k_.value());
                F_[zoneI][0].yy() = f_.value()/sqrt(k_.value());
                F_[zoneI][0].zz() = f_.value()/sqrt(k_.value());

                F_[zoneI][0] = coordSys_.R().transformTensor(F_[zoneI][0]);
            }
        }
        else
        {
            forAll(cellZoneIDs_, zoneI)
            {
                const labelList&amp; cells = mesh_.cellZones()[cellZoneIDs_[zoneI]];

                D_[zoneI].setSize(cells.size());
                F_[zoneI].setSize(cells.size());

                forAll(cells, i)
                {
                    D_[zoneI][i] = tensor::zero;
                    D_[zoneI][i].xx() = 1.0 / k_.value();
                    D_[zoneI][i].yy() = 1.0 / k_.value();
                    D_[zoneI][i].zz() = 1.0 / k_.value();

                    F_[zoneI][i] = tensor::zero;
                    F_[zoneI][i].xx() = f_.value()/sqrt(k_.value());
                    F_[zoneI][i].yy() = f_.value()/sqrt(k_.value());
                    F_[zoneI][i].zz() = f_.value()/sqrt(k_.value());
                }

                const coordinateRotation&amp; R = coordSys_.R(mesh_, cells);

                D_[zoneI] = R.transformTensor(D_[zoneI], cells);
                F_[zoneI] = R.transformTensor(F_[zoneI], cells);
            }
        }
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume
$ wclean libso
$ wmake libso
</pre></div>
</div>
</div>
<div class="section" id="specify-k-and-f-in-boundary">
<h2><a class="toc-backref" href="#id43">1.5.1.39. Specify K and F in boundary</a><a class="headerlink" href="#specify-k-and-f-in-boundary" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/boundary
$ cp -rf darcyForchheimerCalculated darcyForchheimerCoefficients
$ cd darcyForchheimerCoefficients

$ mv darcyForchheimerCalculatedFvPatchScalarField.C darcyForchheimerCoefficientsFvPatchScalarField.C
$ mv darcyForchheimerCalculatedFvPatchScalarField.H darcyForchheimerCoefficientsFvPatchScalarField.H
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ sed -i s/darcyForchheimerCalculated/darcyForchheimerCoefficients/g darcyForchheimerCoefficientsFvPatchScalarField.C
$ sed -i s/darcyForchheimerCalculated/darcyForchheimerCoefficients/g darcyForchheimerCoefficientsFvPatchScalarField.H
$ sed -i s/darcyForchheimerCalculated/darcyForchheimerCoefficients/g Make/files
</pre></div>
</div>
<p>Recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ wmake libso
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ kate darcyForchheimerCoefficientsFvPatchScalarField.C

        dimensionedScalar nu(transportProperties.lookup(&quot;nu&quot;));
        dimensionedScalar k(transportProperties.lookup(&quot;k&quot;));
        dimensionedScalar f(transportProperties.lookup(&quot;f&quot;));


        // The pressure gradient is evaluated at the boundary with the formula:
        // n.grad(p) = -(mu/k)n.U
        // mu.value() allows the access of the value of the object mu declared as a dimensionedScalar
        // patch().nf() returns the normal vector to the patch
        gradient() = -(nu.value()/k.value() + ( f.value()/sqrt(k.value()) )*(U &amp; patch().nf()))*(U &amp; patch().nf());
</pre></div>
</div>
</div>
<div class="section" id="test-zhao-case">
<h2><a class="toc-backref" href="#id44">1.5.1.40. Test Zhao case</a><a class="headerlink" href="#test-zhao-case" title="Permalink to this headline">¶</a></h2>
<p>Create grid:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd porous_037_porousSimpleTwoTemperaturesZhaoProfile
$ rm -rf 0.* [1-9]* postProcessing *.foam
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// The vertices can be defined using variables Lx, Ly, Lz. It saves time to modify the size of the domain

Lx 0.114;     // add the ends
Ly 0.045;
Lz 0.045;
Dx1 0.0057;
Dx2 0.1197;
Dx3 0.1254;


vertices
(
        (0 0 0)
        ($Dx1 0 0)
        ($Dx1 $Ly 0)
        (0 $Ly 0)
        (0 0 $Lz)
        ($Dx1 0 $Lz)
        ($Dx1 $Ly $Lz)
        (0 $Ly $Lz)
        ($Dx2 0 0)
        ($Dx3 0 0)
        ($Dx3 $Ly 0)
        ($Dx2 $Ly 0)
        ($Dx2 0 $Lz)
        ($Dx3 0 $Lz)
        ($Dx3 $Ly $Lz)
        ($Dx2 $Ly $Lz)
);

// Mesh definition (homogeneous grid with a single cell in the y and z axis since the simulation is 1D)

blocks
(
        hex (0 1 2 3 4 5 6 7)
        porosity (6 46 1) simpleGrading (1 1 1)
        hex (1 8 11 2 5 12 15 6)
        porosity (127 46 1) simpleGrading (1 1 1)
        hex (8 9 10 11 12 13 14 15)
        porosity (6 46 1) simpleGrading (1 1 1)
);

edges
(
);

boundary
(
        inlet
        {
            type patch;
            faces
            (
                        (0 4 7 3)
            );
        }
        outlet
        {
            type patch;
            faces
            (
                        (10 14 13 9)
            );
        }

        // Faces orthogonal to y and z axis are defined as «empty» to specify that the simulation is 1D

        wall_upper
        {
            type wall;
            faces
            (
                (3 7 6 2)
                        (2 6 15 11)
                        (11 15 14 10)
            );
        }

        wall_lower
        {
            type wall;
            faces
            (
                (0 1 5 4)
                        (8 9 13 12)
            );
        }

        wall_lower_heated
        {
            type wall;
            faces
            (
                        (1 8 12 5)
            );
        }

        frontAndBack
        {
            type empty;
            faces
            (
                (0 3 2 1)
                (4 5 6 7)
                        (5 12 15 6)
                        (12 13 14 15)
                        (1 2 11 8)
                        (8 11 10 9)
            );
        }

);
</pre></div>
</div>
<p>Change boundary condition so lower wall is heated:</p>
<p>P:</p>
<div class="highlight-python"><div class="highlight"><pre>inlet
{
    type            darcyForchheimerCoefficients;
    value           uniform 0;
}

outlet
{
    type            fixedMean;
    meanValue       0.0;
    value           uniform 0;
}

wall_upper
{
    type            zeroGradient;
}

wall_lower_heated
{
    type            zeroGradient;
}

wall_lower
{
    type            zeroGradient;
}

frontAndBack
{
    type            empty;
}
</pre></div>
</div>
<p>Ts:</p>
<div class="highlight-python"><div class="highlight"><pre>inlet
{
    type    zeroGradient;
}

outlet
{
    type    zeroGradient;
}

wall_upper
{
    type    zeroGradient;
}

wall_lower
{
    type    zeroGradient;
}

wall_lower_heated
{
    type groovyBC;
    valueExpression &quot;Tf&quot;;
    variables &quot;Tf@wall_upper=Tf;&quot;;
    value $internalField;
}

frontAndBack
{
    type            empty;
}
</pre></div>
</div>
<p>Tf:</p>
<div class="highlight-python"><div class="highlight"><pre>inlet
{
    type        fixedValue;
    value           uniform 300;
}

outlet
{
    type        zeroGradient;
}

wall_upper
{
    type            zeroGradient;
}

wall_lower
{
    type            zeroGradient;
}

wall_lower_heated
{
    type            fixedGradient;
    gradient        uniform -447.28;
}

frontAndBack
{
    type        empty;
}
</pre></div>
</div>
<p>U:</p>
<div class="highlight-python"><div class="highlight"><pre>inlet
{
    type            hyperbolicVelocityZhao;
    n               (1 0 0);
    y               (0 1 0);
    maxValue        0.70;
        h                       0.045;
        k                   2.70e-7;
    value           uniform (0 0 0); // Dummy for paraFoam
}

outlet
{
    type        zeroGradient;
}

wall_upper
{
    type        fixedValue;
    value           uniform (0 0 0);
}

wall_lower
{
    type        fixedValue;
    value           uniform (0 0 0);
}

wall_lower_heated
{
    type        fixedValue;
        value               uniform (0 0 0);
}

frontAndBack
{
    type        empty;
}
</pre></div>
</div>
<p>porosityProperties:</p>
<div class="highlight-python"><div class="highlight"><pre>porosity1
{
        type            DarcyForchheimerCoefficients;
        active          yes;
        cellZone        porosity;

        DarcyForchheimerCoefficientsCoeffs
        {

            k k [0 2 0 0 0 0 0] 2.70e-7;
            f f [0 0 0 0 0 0 0] 0.097;

            d d [0 -2 0 0 0 0 0] (1.0 1.0 1.0);
            f f [0 -1 0 0 0 0 0] (1.0 1.0 1.0);

            coordinateSystem
            {
                type    cartesian;
                origin  (0 0 0);
                coordinateRotation
                {
                    type    axesRotation;
                    e1      (1 0 0);
                    e2      (0 1 0);
                }
            }

        }
}
</pre></div>
</div>
<p>transportProperties</p>
<div class="highlight-python"><div class="highlight"><pre>transportModel  Newtonian;

nu             nu [ 0 2 -1 0 0 0 0 ] 1.562e-5;

// For Darcy-Forchheimer BC:

k              k  [ 0 2 0 0 0 0 0 ] 2.70e-7;

f              f  [ 0 0 0 0 0 0 0 ] 0.097;

// For temperature equation:

eps            eps [ 0 0 0 0 0 0 0 ] 0.9726;

kfe            kfe [ 1 1 -3 -1 0 0 0 ] 0.0256;

kse            kse [ 1 1 -3 -1 0 0 0 ] 2.48;

rhof           rhof [ 1 -3 0 0 0 0 0 ] 1.184;

cpf            cpf [ 0 2 -2 -1 0 0 0 ] 1007.0;

hsf            hsf [ 1 0 -3 -1 0 0 0 ] 1101.412;

asf                asf [ 0 -1 0 0 0 0 0 ] 415.4121;
</pre></div>
</div>
<p>controlDict:</p>
<div class="highlight-python"><div class="highlight"><pre>application     porousSimpleTwoTemperaturesZhaoFoam;

startFrom       startTime;

startTime       0;

stopAt          endTime;

endTime         500000;

deltaT          100;

writeControl    runTime;

writeInterval   10000;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

writeCompression off;

timeFormat      general;

timePrecision   6;

runTimeModifiable true;

libs
(
        &quot;ldarcyForchheimerCoefficients.so&quot;
        &quot;libhyperbolicVelocityZhao.so&quot;
        &quot;libmyfiniteVolume.so&quot;
        &quot;libgroovyBC.so&quot;
);
</pre></div>
</div>
<p>sampleDict</p>
<div class="highlight-python"><div class="highlight"><pre>sets
(
        lineX1
        {
            type        midPoint;
            axis        distance;

            //- cavity. Slightly perturbed so not to align with face or edge.
            start       (0.0057 0.000 0.000);
            end         (0.1197 0.000 0.000);
        }

);
</pre></div>
</div>
</div>
<div class="section" id="use-momentum-equation-of-calmidi-and-add-thermal-dispersion">
<h2><a class="toc-backref" href="#id45">1.5.1.41. Use Momentum Equation of Calmidi and add thermal dispersion</a><a class="headerlink" href="#use-momentum-equation-of-calmidi-and-add-thermal-dispersion" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTwoTemperaturesZhaoFoam simpleTwoTemperaturesCalmidiFoam
$ cd simpleTwoTemperaturesCalmidiFoam

$ mv simpleTwoTemperaturesZhaoFoam.C simpleTwoTemperaturesCalmidiFoam.C
$ sed -i s/simpleTwoTemperaturesZhaoFoam/simpleTwoTemperaturesCalmidiFoam/g Make/files

$ createFields.H

        Info&lt;&lt; &quot;Reading diffusion conductivity  kd\n&quot; &lt;&lt; endl;

        dimensionedScalar kd
        (
            transportProperties.lookup(&quot;kd&quot;)
        );

$ nano UEqn.H

        tmp&lt;fvVectorMatrix&gt; UEqn
        (
            (1.0/sqr(eps))*fvm::div(phi, U)
            - fvm::laplacian(nu/eps, U)
            ==
            fvOptions(U)
        );

$ wclean
$ wmake
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Edit the sub-directory</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTwoTemperaturesZhaoFoam porousSimpleTwoTemperaturesCalmidiFoam
$ cd porousSimpleTwoTemperaturesCalmidiFoam
$ sed -i s/porousSimpleTwoTemperaturesZhaoFoam/porousSimpleTwoTemperaturesCalmidiFoam/g Make/files
$ mv porousSimpleTwoTemperaturesZhaoFoam.C porousSimpleTwoTemperaturesCalmidiFoam.C

$ nano UEqn.H

        tmp&lt;fvVectorMatrix&gt; UEqn
        (
            (1.0/sqr(eps))*fvm::div(phi, U)
            - fvm::laplacian(nu/eps, U)
            ==
            fvOptions(U)
        );

$ nano TEqn.H

        // Tf treated as implicit in TfEqn, Ts treated as explicit
        fvScalarMatrix TfEqn
        (
                rhof*cpf*fvm::div(phi,Tf)
            ==
                fvm::laplacian((kfe+kd),Tf,&quot;laplacian(DT,T)&quot;)
                - fvm::Sp(hsf*asf,Tf)
                + hsf*asf*Ts
        );
        TfEqn.relax();
        TfEqn.solve();

$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="profile-of-vafai">
<h2><a class="toc-backref" href="#id46">1.5.1.42. Profile of Vafai</a><a class="headerlink" href="#profile-of-vafai" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/fields/fvPatchFields/derived
$ cp -rf hyperbolicVelocityCalculated hyperbolicVelocityVafai
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd hyperbolicVelocityVafai
$ wclean libso
$ mv hyperbolicVelocityCalculatedFvPatchVectorField.C hyperbolicVelocityVafaiFvPatchVectorField.C
$ mv hyperbolicVelocityCalculatedFvPatchVectorField.H hyperbolicVelocityVafaiFvPatchVectorField.H
$ sed -i s/hyperbolicVelocityCalculated/hyperbolicVelocityVafai/g hyperbolicVelocityVafaiFvPatchVectorField.C
$ sed -i s/hyperbolicVelocityCalculated/hyperbolicVelocityVafai/g hyperbolicVelocityVafaiFvPatchVectorField.H
$ sed -i s/hyperbolicVelocityCalculated/hyperbolicVelocityVafai/g Make/files
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ nano hyperbolicVelocityVafaiFvPatchVectorField.H

//- Peak velocity magnitude
scalar maxValue_;

//- Flow direction
vector n_;

//- Direction of the y-coordinate
vector y_;

//- Forchheimer
        scalar f_;

//- Permeability
        scalar k_;

//- Porosity
scalar epsilon_;

//- Plate height
scalar height_;

//- Fluid kinematic viscosity
scalar kinVisc_;


        //- Return max value
scalar&amp; maxValue()
{
    return maxValue_;
}

//- Return flow direction
vector&amp; n()
{
    return n_;
}

//- Return y direction
vector&amp; y()
{
    return y_;
}

//- Forchheimer
scalar&amp; f()
{
    return f_;
}

//- Forchheimer
scalar&amp; k()
{
    return k_;
}

//- Porosity
scalar&amp; epsilon()
{
    return epsilon_;
}

//- height
scalar&amp; height()
{
    return height_;
}

//- height
scalar&amp; kinVisc()
{
    return kinVisc_;
}
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ nano hyperbolicVelocityVafaiFvPatchVectorField.C

        hyperbolicVelocityVafaiFvPatchVectorField::hyperbolicVelocityVafaiFvPatchVectorField
        (
                const fvPatch&amp; p,
                const DimensionedField&lt;vector, volMesh&gt;&amp; iF
        )
        :
                fixedValueFvPatchVectorField(p, iF),
                maxValue_(0),
                n_(1, 0, 0),
                y_(0, 1, 0),
                f_(1),
                k_(1),
                epsilon_(1),
                height_(1),
                kinVisc_(1)
        {}


        hyperbolicVelocityVafaiFvPatchVectorField::hyperbolicVelocityVafaiFvPatchVectorField
        (
                const hyperbolicVelocityVafaiFvPatchVectorField&amp; ptf,
                const fvPatch&amp; p,
                const DimensionedField&lt;vector, volMesh&gt;&amp; iF,
                const fvPatchFieldMapper&amp; mapper
        )
        :
                fixedValueFvPatchVectorField(ptf, p, iF, mapper),
                maxValue_(ptf.maxValue_),
                n_(ptf.n_),
                y_(ptf.y_),
                f_(ptf.f_),
                k_(ptf.k_),
                epsilon_(ptf.epsilon_),
                height_(ptf.height_),
                kinVisc_(ptf.kinVisc_)
        {}


        hyperbolicVelocityVafaiFvPatchVectorField::hyperbolicVelocityVafaiFvPatchVectorField
        (
                const fvPatch&amp; p,
                const DimensionedField&lt;vector, volMesh&gt;&amp; iF,
                const dictionary&amp; dict
        )
        :
                fixedValueFvPatchVectorField(p, iF),
                maxValue_(readScalar(dict.lookup(&quot;maxValue&quot;))),
                n_(dict.lookup(&quot;n&quot;)),
                y_(dict.lookup(&quot;y&quot;)),
                f_(readScalar(dict.lookup(&quot;f&quot;))),
                k_(readScalar(dict.lookup(&quot;k&quot;))),
                epsilon_(readScalar(dict.lookup(&quot;epsilon&quot;))),
                height_(readScalar(dict.lookup(&quot;height&quot;))),
                kinVisc_(readScalar(dict.lookup(&quot;kinVisc&quot;)))
        {
                if (mag(n_) &lt; SMALL || mag(y_) &lt; SMALL)
                {
                        FatalErrorIn(&quot;hyperbolicVelocityVafaiFvPatchVectorField(dict)&quot;)
                            &lt;&lt; &quot;n or y given with zero size not correct&quot;
                            &lt;&lt; abort(FatalError);
                }

                n_ /= mag(n_);
                y_ /= mag(y_);

                evaluate();
        }


        hyperbolicVelocityVafaiFvPatchVectorField::hyperbolicVelocityVafaiFvPatchVectorField
        (
                const hyperbolicVelocityVafaiFvPatchVectorField&amp; fcvpvf,
                const DimensionedField&lt;vector, volMesh&gt;&amp; iF
        )
        :
                fixedValueFvPatchVectorField(fcvpvf, iF),
                maxValue_(fcvpvf.maxValue_),
                n_(fcvpvf.n_),
                y_(fcvpvf.y_),
                f_(fcvpvf.f_),
                k_(fcvpvf.k_),
                epsilon_(fcvpvf.epsilon_),
                height_(fcvpvf.height_),
                kinVisc_(fcvpvf.kinVisc_)
        {}


        // * * * * * * * * * * * * * * * Member Functions  * * * * * * * * * * * * * //

        void hyperbolicVelocityVafaiFvPatchVectorField::updateCoeffs()
        {
                if (updated())
                {
                        return;
                }

                // Get range and orientation
                boundBox bb(patch().patch().localPoints(), true);

                vector ctr = 0.5*(bb.max() + bb.min());

                const vectorField&amp; c = patch().Cf();

                // Calculate local 1-D coordinate for the parabolic profile
                scalarField coord = 2*((c - ctr) &amp; y_)/((bb.max() - bb.min()) &amp; y_);

                const double Lambda = ((pow(epsilon_, (3.0/2.0)))*f_*maxValue_*height_) / kinVisc_;
                const double Darcy = k_ / (sqr(height_)*epsilon_);
                const double ACoeff = (2.0 / 3.0)*Lambda*(pow(Darcy, (-1.0/2.0)));
                const double BCoeff = (pow(Darcy, (-1.0))) + (4.0/3.0)*Lambda*pow(Darcy, (-1.0/2.0));
                const double DCoeff = (sqrt(ACoeff + BCoeff))/2.0;
                const double Value = sqrt(ACoeff/(ACoeff + BCoeff));
                const double CCoeff = -(1.0 / DCoeff)*acosh(1.0/Value) - 1.0;

                vectorField::operator=(n_*maxValue_*(1.0 - ((ACoeff+BCoeff)/ACoeff)*sqr(  1.0 / (cosh (DCoeff*  (mag(coord) + CCoeff) ) )   )));

                Info &lt;&lt; &quot;Permeability&quot; &lt;&lt; k_ &lt;&lt; endl;
                Info &lt;&lt; &quot;Forchheimer&quot; &lt;&lt; f_ &lt;&lt; endl;
                Info &lt;&lt; &quot;Lambda&quot; &lt;&lt; Lambda &lt;&lt; endl;
                Info &lt;&lt; &quot;Darcy&quot; &lt;&lt; Darcy &lt;&lt; endl;
                Info &lt;&lt; &quot;ACoeff&quot; &lt;&lt; ACoeff &lt;&lt; endl;
                Info &lt;&lt; &quot;BCoeff&quot; &lt;&lt; BCoeff &lt;&lt; endl;
                Info &lt;&lt; &quot;DCoeff&quot; &lt;&lt; DCoeff &lt;&lt; endl;
                Info &lt;&lt; &quot;CCoeff&quot; &lt;&lt; CCoeff &lt;&lt; endl;
        }


        // Write
        void hyperbolicVelocityVafaiFvPatchVectorField::write(Ostream&amp; os) const
        {
                fvPatchVectorField::write(os);
                os.writeKeyword(&quot;maxValue&quot;)
                        &lt;&lt; maxValue_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;n&quot;)
                        &lt;&lt; n_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;y&quot;)
                        &lt;&lt; y_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;f&quot;)
                        &lt;&lt; f_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;k&quot;)
                        &lt;&lt; k_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;epsilon&quot;)
                        &lt;&lt; epsilon_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;height&quot;)
                        &lt;&lt; height_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                os.writeKeyword(&quot;kinVisc&quot;)
                        &lt;&lt; kinVisc_ &lt;&lt; token::END_STATEMENT &lt;&lt; nl;
                writeEntry(&quot;value&quot;, os);
        }
</pre></div>
</div>
<p>Recompile:</p>
<div class="highlight-python"><div class="highlight"><pre>$ wclean libso
$ wmake libso
</pre></div>
</div>
</div>
<div class="section" id="test-calmidi-case">
<h2><a class="toc-backref" href="#id47">1.5.1.43. Test Calmidi case</a><a class="headerlink" href="#test-calmidi-case" title="Permalink to this headline">¶</a></h2>
<p>Copy case:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_037_porousSimpleTwoTemperaturesZhaoProfile porous_038_porousSimpleTwoTemperaturesCalmidi
</pre></div>
</div>
<p>U:</p>
<div class="highlight-python"><div class="highlight"><pre>inlet
{
    type            hyperbolicVelocityVafai;
    n               (1 0 0);
    y               (0 1 0);
    f                       0.085;
    k                       1.80e-7;
    maxValue        0.61;
    h                           0.045;
    value           uniform (0 0 0); // Dummy for paraFoam
}

outlet
{
    type        zeroGradient;
}

wall_upper
{
    type        fixedValue;
    value   uniform (0 0 0);
}

wall_lower
{
    type     fixedValue;
    value           uniform (0 0 0);
}

wall_lower_heated
{
    type        fixedValue;
            value           uniform (0 0 0);
}

frontAndBack
{
    type        empty;
}
</pre></div>
</div>
<p>Tf:</p>
<div class="highlight-python"><div class="highlight"><pre>inlet
{
    type            fixedValue;
    value           uniform 300;
}

outlet
{
    type            zeroGradient;
}

wall_upper
{
    type            zeroGradient;
}

wall_lower
{
    type            zeroGradient;
}

wall_lower_heated
{
    type            fixedGradient;
    gradient        uniform 445.96;
}

frontAndBack
{
    type            empty;
}
</pre></div>
</div>
<p>Ts:</p>
<div class="highlight-python"><div class="highlight"><pre>inlet
{
    type    zeroGradient;
}

outlet
{
    type    zeroGradient;
}

wall_upper
{
    type    zeroGradient;
}

wall_lower
{
    type    zeroGradient;
}

wall_lower_heated
{
    type groovyBC;
    valueExpression &quot;Tf&quot;;
    variables &quot;Tf@wall_upper=Tf;&quot;;
    value $internalField;
}

frontAndBack
{
    type            empty;
}
</pre></div>
</div>
<p>p:</p>
<div class="highlight-python"><div class="highlight"><pre>inlet
{
    type            darcyForchheimerCoefficients;
    value           uniform 0;
}

outlet
{
    type            fixedMean;
    meanValue       0.0;
    value           uniform 0;
}

wall_upper
{
    type            zeroGradient;
}

wall_lower_heated
{
    type            zeroGradient;
}

wall_lower
{
    type            zeroGradient;
}

frontAndBack
{
    type            empty;
}
</pre></div>
</div>
<p>porosityProperties:</p>
<div class="highlight-python"><div class="highlight"><pre>DarcyForchheimerCoefficientsCoeffs
{

    k k [0 2 0 0 0 0 0] 1.80e-7;
    f f [0 0 0 0 0 0 0] 0.085;

    d d [0 -2 0 0 0 0 0] (1.0 1.0 1.0);
    e e [0 -1 0 0 0 0 0] (1.0 1.0 1.0);

    coordinateSystem
    {
        type    cartesian;
        origin  (0 0 0);
        coordinateRotation
        {
            type    axesRotation;
            e1      (1 0 0);
            e2      (0 1 0);
        }
    }

}
</pre></div>
</div>
<p>transportProperties</p>
<div class="highlight-python"><div class="highlight"><pre>transportModel  Newtonian;

nu             nu [ 0 2 -1 0 0 0 0 ] 1.608e-5;

// For Darcy-Forchheimer BC:

k              k  [ 0 2 0 0 0 0 0 ] 1.80e-7;

f              f  [ 0 0 0 0 0 0 0 ] 0.085;

// For temperature equation:

eps            eps [ 0 0 0 0 0 0 0 ] 0.9726;

kfe            kfe [ 1 1 -3 -1 0 0 0 ] 0.0237;

kse            kse [ 1 1 -3 -1 0 0 0 ] 6.46;

rhof           rhof [ 1 -3 0 0 0 0 0 ] 1.164;

cpf            cpf [ 0 2 -2 -1 0 0 0 ] 1007.0;

hsf            hsf [ 1 0 -3 -1 0 0 0 ] 104.08;

asf                    asf [ 0 -1 0 0 0 0 0 ] 611.25;
</pre></div>
</div>
<p>controlDict</p>
<div class="highlight-python"><div class="highlight"><pre>application     porousSimpleTwoTemperaturesCalmidiFoam;

startFrom       startTime;

startTime       0;

stopAt          endTime;

endTime         500000;

deltaT          100;

writeControl    runTime;

writeInterval   10000;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

writeCompression off;

timeFormat      general;

timePrecision   6;

runTimeModifiable true;

libs
(
        &quot;ldarcyForchheimerCoefficients.so&quot;
        &quot;libhyperbolicVelocityVafai.so&quot;
        &quot;libmyfiniteVolume.so&quot;
        &quot;libgroovyBC.so&quot;
);
</pre></div>
</div>
<p>Copy in residuals:</p>
<div class="highlight-python"><div class="highlight"><pre>residuals
{
        fields ( p U Tf Ts );

        #includeEtc &quot;caseDicts/postProcessing/numerical/residuals.cfg&quot;
}
</pre></div>
</div>
<p>sampleDict:</p>
<div class="highlight-python"><div class="highlight"><pre>lineX1
{
    type        midPoint;
    axis        distance;

    //- cavity. Slightly perturbed so not to align with face or edge - wall.
    start       (0.000 0.000 0.000);
    end         (0.114 0.000 0.000);
}
lineY1
{
    type        midPoint;
    axis        distance;

    //- cavity. Slightly perturbed so not to align with face or edge - inlet.
    start       (0.000 0.000 0.000);
    end         (0.000 0.045 0.000);
}
lineY2
{
    type        midPoint;
    axis        distance;

    //- cavity. Slightly perturbed so not to align with face or edge - centre.
    start       (0.057 0.000 0.000);
    end         (0.057 0.045 0.000);
}
lineY3
{
    type        midPoint;
    axis        distance;

    //- cavity. Slightly perturbed so not to align with face or edge - outlet.
    start       (0.114 0.000 0.000);
    end         (0.114 0.045 0.000);
}
</pre></div>
</div>
<p>controlDict</p>
<div class="highlight-python"><div class="highlight"><pre>application     porousSimpleTwoTemperaturesCalmidiFoam;

startFrom       startTime;

startTime       0;

stopAt          endTime;

endTime         500000;

deltaT          100;

writeControl    runTime;

writeInterval   10000;

purgeWrite      0;

writeFormat     ascii;

writePrecision  6;

writeCompression off;

timeFormat      general;

timePrecision   6;

runTimeModifiable true;

libs
(
        &quot;ldarcyForchheimerCoefficients.so&quot;
        &quot;libhyperbolicVelocityVafai.so&quot;
        &quot;libmyfiniteVolume.so&quot;
        &quot;libgroovyBC.so&quot;
);

functions
{
        residuals
        {
            type            residuals;
            functionObjectLibs (&quot;libutilityFunctionObjects.so&quot;);
            enabled         true;
            outputControl   timeStep;
            outputInterval  1;

            fields
            (
                Ux
                Uy
                Uz
                p
                Tf
                    Ts
            );
        }

        probes
        {
            type                  probes;
            functionObjectLibs    (&quot;libsampling.so&quot;);
            enabled               true;
            outputControl         timeStep;
            outputInterval        1;

            fields
            (
                Ux
                Uy
                Uz
                p
                Tf
                    Ts
            );

            probeLocations
            (
                (0.0114 0.0225 0.0) // Probe 1 centreline
                (0.0570 0.0225 0.0) // Probe 2 centreline
                (0.1026 0.0225 0.0) // Probe 3 centreline
                (0.0114 0.0 0.0) // Probe 4 wall
                (0.0570 0.0 0.0) // Probe 5 wall
                (0.1026 0.0 0.0) // Probe 6 wall
            );
        }
}
</pre></div>
</div>
<p>Monitor residuals:</p>
<div class="highlight-python"><div class="highlight"><pre>$ foamMonitor -l postProcessing/residuals/0/residuals.dattree
$ foamMonitor -l postProcessing/probes/0/p
$ foamMonitor -l postProcessing/probes/0/Tf
$ foamMonitor -l postProcessing/probes/0/Ts

$ porousSimpleTwoTemperaturesCalmidiFoam
$ rm -rf 0.* [1-9]* postProcessing processor* *.foam logs *.png

$ foamCalc mag U

$ gnuplot -persist plot_velocity_probes
</pre></div>
</div>
</div>
<div class="section" id="introduce-transient">
<h2><a class="toc-backref" href="#id48">1.5.1.44. Introduce transient</a><a class="headerlink" href="#introduce-transient" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_038_porousSimpleTwoTemperaturesCalmidi porous_039_porousSimpleTwoTemperaturesCalmidiTransient
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTwoTemperaturesCalmidiFoam simpleTwoTemperaturesCalmidiTransientFoam
$ cd simpleTwoTemperaturesCalmidiTransientFoam

$ mv simpleTwoTemperaturesCalmidiFoam.C simpleTwoTemperaturesCalmidiTransientFoam.C
$ sed -i s/simpleTwoTemperaturesCalmidiFoam/simpleTwoTemperaturesCalmidiTransientFoam/g Make/files
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTwoTemperaturesCalmidiFoam porousSimpleTwoTemperaturesCalmidiTransientFoam
$ cd porousSimpleTwoTemperaturesCalmidiTransientFoam
$ sed -i s/porousSimpleTwoTemperaturesCalmidiFoam/porousSimpleTwoTemperaturesCalmidiTransientFoam/g Make/files
$ mv porousSimpleTwoTemperaturesCalmidiFoam.C porousSimpleTwoTemperaturesCalmidiTransientFoam.C

$ kate TEqn.H

fvScalarMatrix TfEqn
(
      eps*(rhos*cpf)*fvm::ddt(Tf)
    + rhof*cpf*fvm::div(phi,Tf)
    ==
      fvm::laplacian((kfe+kd),Tf,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(hsf*asf,Tf)
    + hsf*asf*Ts
);

TfEqn.relax();
TfEqn.solve();

// Ts treated an implicit in TsEqn, Tf treated as explicit
fvScalarMatrix TsEqn
(
    (1.0 - eps)*(rhos*cps)*fvm::ddt(Ts)
    ==
      fvm::laplacian(kse,Ts,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(hsf*asf,Ts)
    + hsf*asf*Tf
);
TsEqn.relax();
TsEqn.solve();

$ wclean
$ wmake
</pre></div>
</div>
<p>Add to createFields.H</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading fluid density rhos\n&quot; &lt;&lt; endl;

dimensionedScalar rhos
(
    transportProperties.lookup(&quot;rhos&quot;)
);

Info&lt;&lt; &quot;Reading fluid specific heat capacity cps\n&quot; &lt;&lt; endl;

dimensionedScalar cps
(
    transportProperties.lookup(&quot;cps&quot;)
);

$ wclean
$ wmake
</pre></div>
</div>
<p>script:</p>
<div class="highlight-python"><div class="highlight"><pre>gnuplot plot_p_probes
gnuplot plot_residuals
gnuplot plot_Tf_probes
gnuplot plot_Ts_probes
gnuplot plot_velocity_probes

$ chmod 777

$ rm -rf 0.* [1-9]* postProcessing processor* *.foam logs *.png


$ porousSimpleTwoTemperaturesCalmidiTransientFoam &gt; log &amp;


$ sampleDict
</pre></div>
</div>
</div>
<div class="section" id="influence-of-the-grid">
<h2><a class="toc-backref" href="#id49">1.5.1.45. Influence of the grid</a><a class="headerlink" href="#influence-of-the-grid" title="Permalink to this headline">¶</a></h2>
<p>Velocity profile vs Vafai</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp -rf porous_039_porousSimpleTwoTemperaturesCalmidiTransient porous_040_porousSimpleTwoTemperaturesCalmidiTransientMesh
$ rm -rf 0.* [1-9]* postProcessing processor* *.foam logs *.png
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleTwoTemperaturesCalmidiFoam simpleTwoTemperaturesCalmidiTransientFoam
$ cd simpleTwoTemperaturesCalmidiTransientFoam

$ mv simpleTwoTemperaturesCalmidiFoam.C simpleTwoTemperaturesCalmidiTransientFoam.C
$ sed -i s/simpleTwoTemperaturesCalmidiFoam/simpleTwoTemperaturesCalmidiTransientFoam/g Make/files
</pre></div>
</div>
<p>Message: Number of cells/points in mesh and field don&#8217;t match - something in 0 folder e.g. magU doesn;t match the grid.</p>
</div>
<div class="section" id="changed-inlet-pressure-condition-to-fixedfluxpressure">
<h2><a class="toc-backref" href="#id50">1.5.1.46. Changed inlet pressure condition to fixedFluxPressure</a><a class="headerlink" href="#changed-inlet-pressure-condition-to-fixedfluxpressure" title="Permalink to this headline">¶</a></h2>
<p>So that pressure gradient is computed based on velocity - didn&#8217;t work because updateCoeffs for snGradp must be done before updateCoeffs or evaluate.</p>
</div>
<div class="section" id="tried-poroussimplefoam">
<h2><a class="toc-backref" href="#id51">1.5.1.47. Tried porousSimpleFoam</a><a class="headerlink" href="#tried-poroussimplefoam" title="Permalink to this headline">¶</a></h2>
<p>Almost matches maximum. Slighly less diffuse than Vafai.</p>
</div>
<div class="section" id="now-modify-poroussimplefoam-so-that-diffusion-is-included-in-laplacian">
<h2><a class="toc-backref" href="#id52">1.5.1.48. Now modify porousSimpleFoam so that diffusion is included in laplacian</a><a class="headerlink" href="#now-modify-poroussimplefoam-so-that-diffusion-is-included-in-laplacian" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="use-momentum-equation-of-vafai">
<h2><a class="toc-backref" href="#id53">1.5.1.49. Use Momentum Equation of Vafai</a><a class="headerlink" href="#use-momentum-equation-of-vafai" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleFoam simpleEpsilonFoam
$ cd simpleEpsilonFoam

$ mv simpleFoam.C simpleEpsilonFoam.C
$ sed -i s/simpleFoam/simpleEpsilonFoam/g Make/files

$ nano createFields.H

        Info&lt;&lt; &quot;Reading transportProperties\n&quot; &lt;&lt; endl;

        IOdictionary transportProperties
        (
            IOobject
        (
                &quot;transportProperties&quot;,
                runTime.constant(),
                mesh,
                IOobject::MUST_READ,
                IOobject::NO_WRITE
        )
        );

        Info&lt;&lt; &quot;Reading kinematic viscosity nu\n&quot; &lt;&lt; endl;

        dimensionedScalar nu
        (
            transportProperties.lookup(&quot;nu&quot;)
        );

        Info&lt;&lt; &quot;Reading fluid viscosity eps\n&quot; &lt;&lt; endl;

        dimensionedScalar eps
        (
            transportProperties.lookup(&quot;eps&quot;)
        );
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleFoam porousSimpleEpsilonFoam
$ cd porousSimpleEpsilonFoam
$ sed -i s/porousSimpleFoam/porousSimpleEpsilonFoam/g Make/files
$ mv porousSimpleFoam.C porousSimpleEpsilonFoam.C

$ nano UEqn.H

        tmp&lt;fvVectorMatrix&gt; UEqn
        (
            fvm::div(phi, U)
            - fvm::laplacian(nu/eps, U)
            ==
            fvOptions(U)
        );

$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="use-momentum-equation-of-vafai-convection-term-over-epsilon-squared">
<h2><a class="toc-backref" href="#id54">1.5.1.50. Use Momentum Equation of Vafai - convection term over epsilon squared</a><a class="headerlink" href="#use-momentum-equation-of-vafai-convection-term-over-epsilon-squared" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -rf simpleEpsilonFoam simpleEpsilonSquaredFoam
$ cd simpleEpsilonSquaredFoam

$ mv simpleEpsilonFoam.C simpleEpsilonSquaredFoam.C
$ sed -i s/simpleEpsilonFoam/simpleEpsilonSquaredFoam/g Make/files

$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleEpsilonFoam porousSimpleEpsilonSquaredFoam
$ cd porousSimpleEpsilonSquaredFoam
$ sed -i s/porousSimpleEpsilonFoam/porousSimpleEpsilonSquaredFoam/g Make/files
$ mv porousSimpleEpsilonFoam.C porousSimpleEpsilonSquaredFoam.C

$ nano UEqn.H

        tmp&lt;fvVectorMatrix&gt; UEqn
        (
            fvm::div(phi/sqr(eps), U)
            - fvm::laplacian(nu/eps, U)
            ==
            fvOptions(U)
        );

$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="vafai-includes-epsilon-next-to-forchheimer-term">
<h2><a class="toc-backref" href="#id55">1.5.1.51. Vafai includes epsilon next to Forchheimer term</a><a class="headerlink" href="#vafai-includes-epsilon-next-to-forchheimer-term" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/cfdTools/general/porosityModel
$ cp -rf DarcyForchheimerCoefficients DarcyForchheimerCoefficientsEpsilon
$ cd DarcyForchheimerCoefficientsEpsilon

$ mv DarcyForchheimerCoefficients.C DarcyForchheimerCoefficientsEpsilon.C
$ mv DarcyForchheimerCoefficients.H DarcyForchheimerCoefficientsEpsilon.H
$ mv DarcyForchheimerCoefficientsTemplates.C DarcyForchheimerCoefficientsEpsilonTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ sed -i s/DarcyForchheimerCoefficients/DarcyForchheimerCoefficientsEpsilon/g DarcyForchheimerCoefficientsEpsilon.C
$ sed -i s/DarcyForchheimerCoefficients/DarcyForchheimerCoefficientsEpsilon/g DarcyForchheimerCoefficientsEpsilon.H
$ sed -i s/DarcyForchheimerCoefficients/DarcyForchheimerCoefficientsEpsilon/g DarcyForchheimerCoefficientsEpsilonTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/Make
$ gedit files

general = cfdTools/general
porosity = $(general)/porosityModel
$(porosity)/DarcyForchheimerCoefficientsEpsilon/DarcyForchheimerCoefficientsEpsilon.C
LIB = $(FOAM_USER_LIBBIN)/libmyfiniteVolume

$ gedit options

        EXE_INC = \
-I$(LIB_SRC)/triSurface/lnInclude \
-I$(LIB_SRC)/meshTools/lnInclude \
-I$(LIB_SRC)/finiteVolume/lnInclude
LIB_LIBS = \
-lOpenFOAM \
-ltriSurface \
-lmeshTools
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd ..
$ wclean libso
$ wmake libso
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>porosity1
{
    type            DarcyForchheimerCoefficientsEpsilon;
    active          yes;
    cellZone        porosity;

    DarcyForchheimerCoefficientsEpsilonCoeffs
    {

        k k [0 2 0 0 0 0 0] 1.80e-7;
        f f [0 0 0 0 0 0 0] 0.077503;

        d d [0 -2 0 0 0 0 0] (1.0 1.0 1.0);
        e e [0 -1 0 0 0 0 0] (1.0 1.0 1.0);

        coordinateSystem
        {
            type    cartesian;
            origin  (0 0 0);
            coordinateRotation
            {
                type    axesRotation;
                e1      (1 0 0);
                e2      (0 1 0);
            }
        }

    }
}
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/
$ wclean libso
</pre></div>
</div>
</div>
<div class="section" id="add-temperature-to-solver-local-equilibirum-assumption">
<h2><a class="toc-backref" href="#id56">1.5.1.52. 11/09/2017: Add temperature to solver (local equilibirum assumption):</a><a class="headerlink" href="#add-temperature-to-solver-local-equilibirum-assumption" title="Permalink to this headline">¶</a></h2>
<p>simpleEpsilonSquaredTemperatureFoam
porousSimpleEpsilonSquaredTemperatureFoam</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $WM_PROJECT_USER_DIR/applications/solvers/simpleEpsilonSquaredFoam simpleEpsilonSquaredTemperatureFoam
$ cd simpleEpsilonSquaredTemperatureFoam
$ mv simpleEpsilonSquaredFoam.C simpleEpsilonSquaredTemperatureFoam.C
$ sed -i s/simpleEpsilonSquaredFoam/simpleEpsilonSquaredTemperatureFoam/g Make/files
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleEpsilonSquaredFoam porousSimpleEpsilonSquaredTemperatureFoam
$ cd porousSimpleEpsilonSquaredTemperatureFoam
$ sed -i s/porousSimpleEpsilonSquaredFoam/porousSimpleEpsilonSquaredTemperatureFoam/g Make/files
$ mv porousSimpleEpsilonSquaredFoam.C porousSimpleEpsilonSquaredTemperatureFoam.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf 0.* [1-9]* postProcessing processor* *.foam logs *.png
</pre></div>
</div>
<p>Add temperature field to createFields.H</p>
<div class="highlight-python"><div class="highlight"><pre>$ kate createFields.H

    Info&lt;&lt; &quot;Reading field T\n&quot; &lt;&lt; endl;
    volScalarField T
    (
        IOobject
        (
            &quot;T&quot;,
            runTime.timeName(),
            mesh,
            IOobject::MUST_READ,
            IOobject::AUTO_WRITE
        ),
        mesh
    );

    #include &quot;createPhi.H&quot;

    Info&lt;&lt; &quot;Reading effective fluid conductivity kfe\n&quot; &lt;&lt; endl;

    dimensionedScalar kfe
    (
        transportProperties.lookup(&quot;kfe&quot;)
    );

    Info&lt;&lt; &quot;Reading effective solid conductivity kse\n&quot; &lt;&lt; endl;

    dimensionedScalar kse
    (
        transportProperties.lookup(&quot;kse&quot;)
    );

    Info&lt;&lt; &quot;Reading fluid density rhof\n&quot; &lt;&lt; endl;

    dimensionedScalar rhof
    (
        transportProperties.lookup(&quot;rhof&quot;)
    );

    Info&lt;&lt; &quot;Reading fluid specific heat capacity cpf\n&quot; &lt;&lt; endl;

    dimensionedScalar cpf
    (
        transportProperties.lookup(&quot;cpf&quot;)
    );
</pre></div>
</div>
<p>Add TEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>$ kate TEqn.H

    fvScalarMatrix TEqn
    (
        fvm::div(phi,T)
        ==
        fvm::laplacian((kfe+kse)/(rhof*cpf*eps),T,&quot;laplacian(DT,T)&quot;)
    );
    TEqn.relax();
    TEqn.solve();
</pre></div>
</div>
<p>sampleDict modification</p>
<div class="highlight-python"><div class="highlight"><pre>$ kate sampleDict

    fields
    (
        p
        U
        T
    );
</pre></div>
</div>
<p>controlDict modification</p>
<div class="highlight-python"><div class="highlight"><pre>$ kate controlDict

    residuals
    {
        type            residuals;
        functionObjectLibs (&quot;libutilityFunctionObjects.so&quot;);
        enabled         true;
        outputControl   timeStep;
        outputInterval  1;

        fields
        (
            U
            p
            T
        );
    }

    probes
    {

        type                      probes;
        functionObjectLibs    (&quot;libsampling.so&quot;);
        enabled                   true;
        outputControl             timeStep;
        outputInterval            1;
        fields
        (
            U
            p
            T
        );

        probeLocations
        (
            (0.0049 0.0225 0.0) // Probe 1 centreline
            (0.0189 0.0225 0.0) // Probe 2 centreline
            (0.0386 0.0225 0.0) // Probe 3 centreline
            (0.0816 0.0225 0.0) // Probe 4 centreline
            (0.1054 0.0225 0.0) // Probe 5 centreline
            (0.0049 0.0 0.0) // Probe 1 wall
            (0.0189 0.0 0.0) // Probe 2 wall
            (0.0386 0.0 0.0) // Probe 3 wall
            (0.0816 0.0 0.0) // Probe 4 wall
            (0.1054 0.0 0.0) // Probe 5 wall
        );
    }
</pre></div>
</div>
<p>Temperature doesn&#8217;t change</p>
<p>controlDict</p>
<div class="highlight-python"><div class="highlight"><pre>ddtSchemes
{
    default         steadyState;
}

deltaT          1;
</pre></div>
</div>
<p>fvSchemes</p>
<div class="highlight-python"><div class="highlight"><pre>div(phi,T) bounded Gauss upwind;
</pre></div>
</div>
<p>porousSimpleEpsilonSquaredTemperatureFoam.C - include TEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>while (simple.loop())
    {
        Info&lt;&lt; &quot;Time = &quot; &lt;&lt; runTime.timeName() &lt;&lt; nl &lt;&lt; endl;

        // Pressure-velocity SIMPLE corrector
        {
            #include &quot;UEqn.H&quot;
            #include &quot;pEqn.H&quot;
        }

        turbulence-&gt;correct();

        #include &quot;TEqn.H&quot;

        runTime.write();

        Info&lt;&lt; &quot;ExecutionTime = &quot; &lt;&lt; runTime.elapsedCpuTime() &lt;&lt; &quot; s&quot;
            &lt;&lt; &quot;  ClockTime = &quot; &lt;&lt; runTime.elapsedClockTime() &lt;&lt; &quot; s&quot;
            &lt;&lt; nl &lt;&lt; endl;
    }
</pre></div>
</div>
<p>fvSolution</p>
<div class="highlight-python"><div class="highlight"><pre>T
{
    solver          PBiCG;
    preconditioner  DILU;
    tolerance       1e-06;
    relTol          0;
}
</pre></div>
</div>
</div>
<div class="section" id="change-viscosity-name">
<h2><a class="toc-backref" href="#id57">1.5.1.53. 28/10/2017: Change viscosity name:</a><a class="headerlink" href="#change-viscosity-name" title="Permalink to this headline">¶</a></h2>
<p>simpleEpsilonSquaredTemperatureConductivityFoam
porousSimpleEpsilonSquaredTemperatureConductivityFoam</p>
<div class="highlight-python"><div class="highlight"><pre>$ two
$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $WM_PROJECT_USER_DIR/applications/solvers/simpleEpsilonSquaredTemperatureFoam simpleEpsilonSquaredTemperatureConductivityFoam
$ cd simpleEpsilonSquaredTemperatureConductivityFoam
$ mv simpleEpsilonSquaredTemperatureFoam.C simpleEpsilonSquaredTemperatureConductivityFoam.C
$ sed -i s/simpleEpsilonSquaredTemperatureFoam/simpleEpsilonSquaredTemperatureConductivityFoam/g Make/files

$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleEpsilonSquaredTemperatureFoam porousSimpleEpsilonSquaredTemperatureConductivityFoam
$ cd porousSimpleEpsilonSquaredTemperatureConductivityFoam
$ sed -i s/porousSimpleEpsilonSquaredTemperatureFoam/porousSimpleEpsilonSquaredTemperatureConductivityFoam/g Make/files
$ mv porousSimpleEpsilonSquaredTemperatureFoam.C porousSimpleEpsilonSquaredTemperatureConductivityFoam.C

$ wclean
$ wmake
</pre></div>
</div>
<p>Find</p>
<div class="highlight-python"><div class="highlight"><pre>$ find -name &#39;*.H*&#39; | xargs grep -n &#39;.*nu.*&#39;
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd $WM_PROJECT_USER_DIR/src/finiteVolume/cfdTools/general/porosityModel
$ cp -rf DarcyBrinkmannForchheimer DarcyBrinkmannForchheimerConductivity
$ cd DarcyBrinkmannForchheimerConductivity

$ mv DarcyForchheimer.C DarcyBrinkmannForchheimerConductivity.C
$ mv DarcyForchheimer.H DarcyBrinkmannForchheimerConductivity.H
$ mv DarcyForchheimerTemplates.C DarcyBrinkmannForchheimerConductivityTemplates.C
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ sed -i s/DarcyForchheimer/DarcyBrinkmannForchheimerConductivity/g DarcyBrinkmannForchheimerConductivity.C
$ sed -i s/DarcyForchheimer/DarcyBrinkmannForchheimerConductivity/g DarcyBrinkmannForchheimerConductivity.H
$ sed -i s/DarcyForchheimer/DarcyBrinkmannForchheimerConductivity/g DarcyBrinkmannForchheimerConductivityTemplates.C

changed nu to nulaminar so it is read by dictionary
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ cd Make
general = cfdTools/general
porosity = $(general)/porosityModel
$(porosity)/DarcyBrinkmannForchheimerConductivity/DarcyBrinkmannForchheimerConductivity.C
LIB = $(FOAM_USER_LIBBIN)/libmyfiniteVolume

$ cd ..
$ wclean libso
$ wmake libso


porosity1
{
    type            DarcyBrinkmannForchheimerConductivity;
    active          yes;
    cellZone        porosity;

    DarcyForchheimerCoeffs
    {
        d   d [0 -2 0 0 0 0 0] (4.20323662e9 4.20323662e9 4.20323662e9);
        f   f [0 -1 0 0 0 0 0] (30055.40166205 30055.40166205 30055.40166205);

        coordinateSystem
        {
            type    cartesian;
            origin  (0 0 0);
            coordinateRotation
            {
                type    axesRotation;
                e1      (1 0 0);
                e2      (0 1 0);
            }
        }
    }
}

Added to controlDict:

    &quot;libmyfiniteVolume.so&quot;

Added to porosityProperties:

    DarcyBrinkmannForchheimerConductivity
</pre></div>
</div>
</div>
<div class="section" id="add-dictionary-entires-dt-and-w">
<h2><a class="toc-backref" href="#id58">1.5.1.54. 31/10/2017: Add dictionary entires dt and w:</a><a class="headerlink" href="#add-dictionary-entires-dt-and-w" title="Permalink to this headline">¶</a></h2>
<p>simpleEpsilonSquaredTemperatureConductivityWallFoam
porousSimpleEpsilonSquaredTemperatureConductivityWallFoam</p>
<div class="highlight-python"><div class="highlight"><pre>$ two
$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $WM_PROJECT_USER_DIR/applications/solvers/simpleEpsilonSquaredTemperatureConductivityFoam simpleEpsilonSquaredTemperatureConductivityWallFoam
$ cd simpleEpsilonSquaredTemperatureConductivityWallFoam
$ mv simpleEpsilonSquaredTemperatureConductivityFoam.C simpleEpsilonSquaredTemperatureConductivityWallFoam.C
$ sed -i s/simpleEpsilonSquaredTemperatureConductivityFoam/simpleEpsilonSquaredTemperatureConductivityWallFoam/g Make/files

$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleEpsilonSquaredTemperatureConductivityFoam porousSimpleEpsilonSquaredTemperatureConductivityWallFoam
$ cd porousSimpleEpsilonSquaredTemperatureConductivityWallFoam
$ sed -i s/porousSimpleEpsilonSquaredTemperatureConductivityFoam/porousSimpleEpsilonSquaredTemperatureConductivityWallFoam/g Make/files
$ mv porousSimpleEpsilonSquaredTemperatureConductivityFoam.C porousSimpleEpsilonSquaredTemperatureConductivityWallFoam.C

$ wclean
$ wmake
</pre></div>
</div>
<p>Find</p>
<blockquote>
<div>$ find -name &#8216;<em>.H</em>&#8216; | xargs grep -n &#8216;.*nu.*&#8217;</div></blockquote>
<p>Add dt and w to createFields.H</p>
<div class="highlight-python"><div class="highlight"><pre>$ kate createFields.H

    Info&lt;&lt; &quot;Reading dt\n&quot; &lt;&lt; endl;

    dimensionedScalar dt
    (
        transportProperties.lookup(&quot;dt&quot;)
    );

    Info&lt;&lt; &quot;Reading w\n&quot; &lt;&lt; endl;

    dimensionedScalar w
    (
        transportProperties.lookup(&quot;w&quot;)
    );
</pre></div>
</div>
<p>Add dt and w to equations in TEqn.H:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">kd</span><span class="o">=</span><span class="n">d_t</span><span class="o">*</span><span class="n">rhof</span><span class="o">*</span><span class="n">cpf</span><span class="o">*</span><span class="n">U</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mesh</span><span class="o">.</span><span class="n">C</span><span class="p">()</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">dp</span><span class="p">)));</span>

<span class="n">kd_2</span><span class="o">=</span><span class="n">d_t</span><span class="o">*</span><span class="n">rhof</span><span class="o">*</span><span class="n">cpf</span><span class="o">*</span><span class="n">U</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">H</span><span class="o">-</span><span class="n">mesh</span><span class="o">.</span><span class="n">C</span><span class="p">()</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">dp</span><span class="p">)));</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id59">1.5.1.55. Two temperatures</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>simpleTwoTemperaturesFoam
porousSimpleTwoTemperaturesFoam</p>
<div class="highlight-python"><div class="highlight"><pre>$ two
$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $WM_PROJECT_USER_DIR/applications/solvers/simpleEpsilonSquaredTemperatureConductivityWallFoam simpleTwoTemperaturesFoam
$ cd simpleTwoTemperaturesFoam
$ mv simpleEpsilonSquaredTemperatureConductivityWallFoam.C simpleTwoTemperaturesFoam.C
$ sed -i s/simpleEpsilonSquaredTemperatureConductivityWallFoam/simpleTwoTemperaturesFoam/g Make/files

$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleEpsilonSquaredTemperatureConductivityWallFoam porousSimpleTwoTemperaturesFoam
$ cd porousSimpleTwoTemperaturesFoam
$ sed -i s/porousSimpleEpsilonSquaredTemperatureConductivityWallFoam/porousSimpleTwoTemperaturesFoam/g Make/files
$ mv porousSimpleEpsilonSquaredTemperatureConductivityWallFoam.C porousSimpleTwoTemperaturesFoam.C

$ wclean
$ wmake
</pre></div>
</div>
<p>TEqn.H</p>
<div class="highlight-python"><div class="highlight"><pre>kd = (kse+kfe)*0.1*U.component(0)/u_mean;

// update coupled boundaries
kd.correctBoundaryConditions();

//record updated kd
if(runTime.outputTime())
{
  kd.write();
}

// Tf treated as implicit in TfEqn, Ts treated as explicit
fvScalarMatrix TfEqn
(
      rhof*cpf*fvm::div(phi,Tf)
    ==
      fvm::laplacian((kfe+kd),Tf,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(hsf*asf,Tf)
    + hsf*asf*Ts
);

TfEqn.relax();
TfEqn.solve();

// Ts treated an implicit in TsEqn, Tf treated as explicit
fvScalarMatrix TsEqn
(
      fvm::laplacian(kse,Ts,&quot;laplacian(DT,T)&quot;)
    - fvm::Sp(hsf*asf,Ts)
    + hsf*asf*Tf
);

TsEqn.relax();
TsEqn.solve();
</pre></div>
</div>
<p>createFields.H</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading interfacial heat transfer coefficient hsf\n&quot; &lt;&lt; endl;

dimensionedScalar hsf
(
    transportProperties.lookup(&quot;hsf&quot;)
);

Info&lt;&lt; &quot;Reading surface area density asf\n&quot; &lt;&lt; endl;

dimensionedScalar asf
(
    transportProperties.lookup(&quot;asf&quot;)
);
</pre></div>
</div>
<p>createFields.H</p>
<div class="highlight-python"><div class="highlight"><pre>Info&lt;&lt; &quot;Reading field Ts\n&quot; &lt;&lt; endl;
volScalarField Ts
(
    IOobject
    (
        &quot;Ts&quot;,
        runTime.timeName(),
        mesh,
        IOobject::MUST_READ,
        IOobject::AUTO_WRITE
    ),
    mesh
);


Info&lt;&lt; &quot;Reading field Tf\n&quot; &lt;&lt; endl;
volScalarField Tf
(
    IOobject
    (
        &quot;Tf&quot;,
        runTime.timeName(),
        mesh,
        IOobject::MUST_READ,
        IOobject::AUTO_WRITE
    ),
    mesh
);
</pre></div>
</div>
</div>
<div class="section" id="two-temperatures-plus-dispersion">
<h2><a class="toc-backref" href="#id60">1.5.1.56. Two temperatures plus dispersion</a><a class="headerlink" href="#two-temperatures-plus-dispersion" title="Permalink to this headline">¶</a></h2>
<p>simpleTwoTemperaturesDispersionFoam
porousSimpleTwoTemperaturesDispersionFoam</p>
<div class="highlight-python"><div class="highlight"><pre>$ two
$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $WM_PROJECT_USER_DIR/applications/solvers/simpleTwoTemperaturesFoam simpleTwoTemperaturesDispersionFoam
$ cd simpleTwoTemperaturesDispersionFoam
$ mv simpleTwoTemperaturesFoam.C simpleTwoTemperaturesDispersionFoam.C
$ sed -i s/simpleTwoTemperaturesFoam/simpleTwoTemperaturesDispersionFoam/g Make/files

$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTwoTemperaturesFoam porousSimpleTwoTemperaturesDispersionFoam
$ cd porousSimpleTwoTemperaturesDispersionFoam
$ sed -i s/porousSimpleTwoTemperaturesFoam/porousSimpleTwoTemperaturesDispersionFoam/g Make/files
$ mv porousSimpleTwoTemperaturesFoam.C porousSimpleTwoTemperaturesDispersionFoam.C

$ wclean
$ wmake
</pre></div>
</div>
</div>
<div class="section" id="two-temperatures-axi-symmetric">
<h2><a class="toc-backref" href="#id61">1.5.1.57. Two temperatures axi symmetric</a><a class="headerlink" href="#two-temperatures-axi-symmetric" title="Permalink to this headline">¶</a></h2>
<p>simpleTwoTemperaturesDispersionAxiSymmetricFoam
porousSimpleTwoTemperaturesDispersionAxiSymmetricFoam</p>
<div class="highlight-python"><div class="highlight"><pre>$ two
$ cd $WM_PROJECT_USER_DIR/applications/solvers/
$ cp -r $WM_PROJECT_USER_DIR/applications/solvers/simpleTwoTemperaturesDispersionFoam simpleTwoTemperaturesDispersionAxiSymmetricFoam
$ cd simpleTwoTemperaturesDispersionAxiSymmetricFoam
$ mv simpleTwoTemperaturesDispersionFoam.C simpleTwoTemperaturesDispersionAxiSymmetricFoam.C
$ sed -i s/simpleTwoTemperaturesDispersionFoam/simpleTwoTemperaturesDispersionAxiSymmetricFoam/g Make/files

$ wclean
$ wmake
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>$ mv porousSimpleTwoTemperaturesDispersionFoam porousSimpleTwoTemperaturesDispersionAxiSymmetricFoam
$ cd porousSimpleTwoTemperaturesDispersionAxiSymmetricFoam
$ mv porousSimpleTwoTemperaturesDispersionFoam.C porousSimpleTwoTemperaturesDispersionAxiSymmetricFoam.C
$ sed -i s/porousSimpleTwoTemperaturesDispersionFoam/porousSimpleTwoTemperaturesDispersionAxiSymmetricFoam/g Make/files


$ wclean
$ wmake
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="openfoam_projects.html">1.5. OpenFOAM Projects (Password Protected)</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="powder_notes.html">1.5.2. Powder Notes</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>